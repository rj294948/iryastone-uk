<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details - StoneCraft UK</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ===== GLOBAL STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
            padding-top: 100px;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }
        
        .section-title {
            font-size: 24px;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #b8860b;
            display: inline-block;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 24px;
            background: #b8860b;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s ease;
            text-decoration: none;
            text-align: center;
        }
        
        .btn:hover {
            background: #a3780a;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(184, 134, 11, 0.3);
        }
        
        .btn-secondary {
            background: #333;
        }
        
        .btn-secondary:hover {
            background: #222;
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid #b8860b;
            color: #b8860b;
        }
        
        .btn-outline:hover {
            background: #b8860b;
            color: white;
        }
        
        /* ===== HEADER STYLES (CATEGORY PAGE JAISE) ===== */
        header {
            background-color: #fff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            transition: transform 0.4s ease;
        }
        
        .trust-info {
            flex: 1;
            text-align: center;
            padding: 0 10px;
            margin-top: 0;
            padding-top: 5px;
        }
        
        .trust-info-content {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            font-size: 13px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 5px 10px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }
        
        .trust-item {
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 6px;
        }
        
        .trust-item i {
            color: #b8860b;
            font-size: 14px;
        }

        .main-header {
            padding: 5px 0;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
        }
        
        .logo h1 {
            font-size: 24px;
            color: #333;
            font-weight: 700;
        }
        
        .logo span {
            color: #b8860b;
        }

        .banner-text {
            background: linear-gradient(135deg, #b8860b, #a3780a);
            color: white;
            padding: 2px 0;
            text-align: center;
            font-size: 12px;
            font-weight: 500;
            margin: 0;
            line-height: 1.2;
        }

        .user-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-action {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: #555;
            font-size: 11px;
            transition: color 0.3s;
        }

        .user-action:hover {
            color: #b8860b;
        }

        .user-action i {
            font-size: 18px;
            margin-bottom: 2px;
        }

        /* ===== PRODUCT PAGE LAYOUT ===== */
        .product-page {
            padding: 40px 0 80px;
        }
        
        .product-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 60px;
        }
        
        /* ===== PRODUCT IMAGE SECTION ===== */
        .product-image-section {
            position: relative;
        }
        
        /* Main Image Container */
        .main-image-container {
            position: relative;
            width: 100%;
            height: 500px;
            overflow: hidden;
            border-radius: 10px;
            background: #fff;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            cursor: zoom-in;
            margin-bottom: 15px;
        }
        
        #mainProductImage {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        /* ‚úÖ FIXED: Lens Zoom Effect */
        .zoom-lens {
            position: absolute;
            border: 2px solid #b8860b;
            background: rgba(184, 134, 11, 0.2);
            cursor: none;
            display: none;
            z-index: 10;
            pointer-events: none;
            width: 150px;
            height: 150px;
        }
        
        .zoom-result {
            position: absolute;
            top: 0;
            right: -120%;
            width: 100%;
            height: 100%;
            background: #fff;
            border-radius: 10px;
            overflow: hidden;
            display: none;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            z-index: 20;
            border: 1px solid #ddd;
        }
        
        .zoom-result-img {
            width: 200%;
            height: 200%;
            object-fit: cover;
            object-position: 0 0;
        }
        
        /* Fullscreen Lightbox */
        .lightbox {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .lightbox.active {
            opacity: 1;
            visibility: visible;
        }
        
        .lightbox-content {
            position: relative;
            max-width: 90%;
            max-height: 90%;
        }
        
        .lightbox-img {
            width: 100%;
            height: auto;
            max-height: 80vh;
            object-fit: contain;
            border-radius: 5px;
        }
        
        .lightbox-close {
            position: absolute;
            top: -50px;
            right: 0;
            background: none;
            border: none;
            color: white;
            font-size: 30px;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .lightbox-close:hover {
            color: #b8860b;
        }
        
        .lightbox-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s;
        }
        
        .lightbox-nav:hover {
            background: #b8860b;
        }
        
        .lightbox-prev {
            left: 20px;
        }
        
        .lightbox-next {
            right: 20px;
        }
        
        /* Thumbnail Strip */
        .thumbnail-strip {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 10px 0;
            scrollbar-width: thin;
        }
        
        .thumbnail-strip::-webkit-scrollbar {
            height: 6px;
        }
        
        .thumbnail-strip::-webkit-scrollbar-thumb {
            background: #b8860b;
            border-radius: 3px;
        }
        
        .thumbnail-item {
            flex: 0 0 auto;
            width: 80px;
            height: 80px;
            border-radius: 5px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .thumbnail-item:hover {
            border-color: #b8860b;
            transform: translateY(-3px);
        }
        
        .thumbnail-item.active {
            border-color: #b8860b;
            box-shadow: 0 3px 10px rgba(184, 134, 11, 0.3);
        }
        
        .thumbnail-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* ===== PRODUCT DETAILS SECTION ===== */
        .product-details-section {
            padding: 20px 0;
        }
        
        .product-title {
            font-size: 32px;
            color: #333;
            margin-bottom: 10px;
            line-height: 1.2;
        }
        
        .product-price {
            font-size: 28px;
            color: #b8860b;
            font-weight: 700;
            margin-bottom: 20px;
        }
        
        .product-price span {
            font-size: 16px;
            color: #666;
            font-weight: normal;
        }
        
        .product-rating {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .stars {
            color: #ffc107;
            margin-right: 10px;
        }
        
        .rating-count {
            color: #666;
            font-size: 14px;
        }
        
        .product-description {
            margin-bottom: 30px;
            color: #555;
            line-height: 1.6;
        }
        
        /* Product Options */
        .product-options {
            margin-bottom: 30px;
        }
        
        .option-group {
            margin-bottom: 20px;
        }
        
        .option-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }
        
        .option-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .option-item {
            padding: 8px 16px;
            border: 2px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .option-item:hover {
            border-color: #b8860b;
        }
        
        .option-item.selected {
            border-color: #b8860b;
            background: rgba(184, 134, 11, 0.1);
        }
        
        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            position: relative;
        }
        
        .color-option.selected::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            text-shadow: 0 0 2px rgba(0,0,0,0.5);
        }
        
        /* Specifications Table */
        .specifications {
            margin-bottom: 30px;
        }
        
        .spec-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }
        
        .spec-table tr {
            border-bottom: 1px solid #eee;
        }
        
        .spec-table tr:last-child {
            border-bottom: none;
        }
        
        .spec-table td {
            padding: 12px 15px;
        }
        
        .spec-table td:first-child {
            font-weight: 600;
            width: 40%;
            background: #f9f9f9;
        }
        
        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        .action-buttons .btn {
            flex: 1;
        }
        
        .quantity-selector {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .quantity-label {
            margin-right: 15px;
            font-weight: 600;
        }
        
        .quantity-controls {
            display: flex;
            align-items: center;
            border: 1px solid #ddd;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .quantity-btn {
            width: 40px;
            height: 40px;
            background: #f8f9fa;
            border: none;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .quantity-btn:hover {
            background: #e9ecef;
        }
        
        .quantity-input {
            width: 60px;
            height: 40px;
            border: none;
            text-align: center;
            font-size: 16px;
            border-left: 1px solid #ddd;
            border-right: 1px solid #ddd;
        }
        
        /* ===== RELATED PRODUCTS SECTION ===== */
        .related-products-section {
            padding: 40px 0;
        }
        
        .related-products-container {
            position: relative;
        }
        
        .related-products-slider {
            display: flex;
            gap: 20px;
            overflow-x: auto;
            scroll-behavior: smooth;
            padding: 20px 10px;
            scrollbar-width: none; /* Firefox */
        }
        
        .related-products-slider::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Edge */
        }
        
        .related-product-card {
            flex: 0 0 auto;
            width: 250px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s ease;
            cursor: pointer;
        }
        
        .related-product-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }
        
        .related-product-img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        
        .related-product-info {
            padding: 15px;
        }
        
        .related-product-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }
        
        .related-product-price {
            color: #b8860b;
            font-weight: 700;
            font-size: 18px;
        }
        
        .slider-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        
        .slider-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: 2px solid #b8860b;
            color: #b8860b;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 18px;
            transition: all 0.3s;
        }
        
        .slider-btn:hover {
            background: #b8860b;
            color: white;
        }
        
        .slider-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .slider-btn:disabled:hover {
            background: white;
            color: #b8860b;
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 50px 0;
            color: #666;
        }

        .loading i {
            font-size: 40px;
            color: #b8860b;
            margin-bottom: 20px;
            display: block;
        }

        .loading p {
            font-size: 18px;
        }

        .error-message {
            text-align: center;
            padding: 50px 20px;
            color: #d32f2f;
            background: #ffebee;
            border-radius: 10px;
            margin: 20px 0;
        }

        .error-message i {
            font-size: 40px;
            margin-bottom: 15px;
            display: block;
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 992px) {
            .product-container {
                grid-template-columns: 1fr;
                gap: 30px;
            }
            
            .main-image-container {
                height: 400px;
            }
            
            .product-title {
                font-size: 28px;
            }
            
            .action-buttons {
                flex-direction: column;
            }

            .zoom-result {
                right: -110%;
                width: 90%;
            }
        }
        
        @media (max-width: 768px) {
            body {
                padding-top: 80px;
            }

            .product-page {
                padding: 20px 0 50px;
            }
            
            .main-image-container {
                height: 350px;
            }
            
            .product-title {
                font-size: 24px;
            }
            
            .product-price {
                font-size: 24px;
            }
            
            .related-product-card {
                width: 200px;
            }
            
            .related-product-img {
                height: 150px;
            }
            
            .lightbox-nav {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }

            .zoom-result {
                display: none !important;
            }
        }
        
        @media (max-width: 576px) {
            .main-image-container {
                height: 300px;
            }
            
            .thumbnail-item {
                width: 60px;
                height: 60px;
            }
            
            .option-list {
                gap: 8px;
            }
            
            .option-item {
                padding: 6px 12px;
                font-size: 14px;
            }
            
            .color-option {
                width: 35px;
                height: 35px;
            }
            
            .spec-table td {
                padding: 10px 12px;
                font-size: 14px;
            }
            
            .related-product-card {
                width: 180px;
            }
            
            .related-product-img {
                height: 130px;
            }
        }
        
        @media (max-width: 480px) {
            .main-image-container {
                height: 250px;
            }
            
            .action-buttons .btn {
                padding: 10px 16px;
                font-size: 14px;
            }
            
            .quantity-btn, .quantity-input {
                height: 35px;
            }
            
            .quantity-btn {
                width: 35px;
            }
            
            .related-product-card {
                width: 160px;
            }
        }
        
        /* ===== ANIMATIONS ===== */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease;
        }
        
        /* ===== UTILITY CLASSES ===== */
        .text-center {
            text-align: center;
        }
        
        .mt-20 {
            margin-top: 20px;
        }
        
        .mb-20 {
            margin-bottom: 20px;
        }
        
        .mb-30 {
            margin-bottom: 30px;
        }
        
        .mb-40 {
            margin-bottom: 40px;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <!-- ===== HEADER (CATEGORY PAGE JAISE) ===== -->
    <header id="mainHeader">
        <div class="trust-info">
            <div class="trust-info-content">
                <div class="trust-item">
                    <i class="fas fa-truck"></i>
                    <span>Free UK Delivery</span>
                </div>
                <div class="trust-item">
                    <i class="fas fa-star"></i>
                    <span>Rated 4.8/5</span>
                </div>
                <div class="trust-item">
                    <i class="fas fa-award"></i>
                    <span>BSF Member</span>
                </div>
            </div>
        </div>

        <div class="main-header">
            <div class="container header-content">
                <div class="logo">
                    <a href="index.html" style="text-decoration: none; color: inherit;">
                        <h1>Stone<span>Craft</span></h1>
                    </a>
                </div>
                
                <div class="user-actions">
                    <a href="login.html" class="user-action">
                        <i class="fas fa-user"></i>
                        <span>Sign In</span>
                    </a>
                    
                    <a href="#" class="user-action">
                        <i class="fas fa-shopping-cart"></i>
                        <span>Cart (0)</span>
                    </a>
                </div>
            </div>
        </div>

        <div class="banner-text">
            <div class="container">
                Premium Natural Stone Collections - Sandstone, Marble & Limestone for UK Homes & Commercial Projects
            </div>
        </div>
    </header>

    <!-- ===== PRODUCT PAGE ===== -->
    <div class="product-page">
        <div class="container">
            <!-- Loading State -->
            <div class="loading" id="loadingState">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading product details...</p>
            </div>

            <!-- Error State -->
            <div class="error-message hidden" id="errorState">
                <i class="fas fa-exclamation-triangle"></i>
                <h3>Product Not Found</h3>
                <p>We couldn't load the product details. Please try again.</p>
                <a href="category-products.html" class="btn mt-20">Browse Products</a>
            </div>

            <!-- Product Main Layout (Hidden by default) -->
            <div class="product-container hidden" id="productContent">
                <!-- Left: Product Images -->
                <div class="product-image-section">
                    <!-- Main Image with Zoom -->
                    <div class="main-image-container" id="mainImageContainer">
                        <img src="" alt="Product Image" id="mainProductImage">
                        <div class="zoom-lens" id="zoomLens"></div>
                        <div class="zoom-result" id="zoomResult">
                            <img src="" alt="Zoomed View" class="zoom-result-img" id="zoomResultImg">
                        </div>
                    </div>
                    
                    <!-- Thumbnail Strip -->
                    <div class="thumbnail-strip" id="thumbnailStrip">
                        <!-- Thumbnails will be dynamically added here -->
                    </div>
                </div>
                
                <!-- Right: Product Details -->
                <div class="product-details-section">
                    <h1 class="product-title" id="productTitle">Loading...</h1>
                    
                    <div class="product-price" id="productPrice">
                        ¬£0.00 <span id="priceUnit">per unit</span>
                    </div>
                    
                    <div class="product-rating">
                        <div class="stars" id="productRating">
                            <!-- Stars will be dynamically added -->
                        </div>
                        <div class="rating-count" id="ratingCount">(0 reviews)</div>
                    </div>
                    
                    <p class="product-description" id="productDescription">
                        Loading description...
                    </p>
                    
                    <!-- Product Options -->
                    <div class="product-options" id="productOptions">
                        <!-- Options will be dynamically added -->
                    </div>
                    
                    <!-- Quantity Selector -->
                    <div class="quantity-selector">
                        <div class="quantity-label">Quantity:</div>
                        <div class="quantity-controls">
                            <button class="quantity-btn" id="quantityDecrease">-</button>
                            <input type="number" class="quantity-input" id="quantityInput" value="1" min="1" max="100">
                            <button class="quantity-btn" id="quantityIncrease">+</button>
                        </div>
                        <div style="margin-left: auto; font-weight: 600;">
                            Total: ¬£<span id="totalPrice">0.00</span>
                        </div>
                    </div>
                    
                    <!-- Specifications Table -->
                    <div class="specifications">
                        <h3 class="section-title">Specifications</h3>
                        <table class="spec-table">
                            <tbody id="specificationsTable">
                                <!-- Specifications will be dynamically added -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="action-buttons">
                        <button class="btn" id="addToCartBtn">
                            <i class="fas fa-shopping-cart"></i> Add to Cart
                        </button>
                        <button class="btn btn-secondary" id="buyNowBtn">
                            <i class="fas fa-bolt"></i> Buy Now
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Related Products Section -->
            <div class="related-products-section hidden" id="relatedProductsSection">
                <h2 class="section-title text-center">Related Products</h2>
                <div class="related-products-container">
                    <div class="related-products-slider" id="relatedProductsSlider">
                        <!-- Related products will be dynamically added -->
                    </div>
                    <div class="slider-controls">
                        <button class="slider-btn" id="sliderPrevBtn" aria-label="Previous">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button class="slider-btn" id="sliderNextBtn" aria-label="Next">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Lightbox for Fullscreen Images -->
    <div class="lightbox" id="lightbox">
        <button class="lightbox-close" id="lightboxClose">
            <i class="fas fa-times"></i>
        </button>
        <button class="lightbox-nav lightbox-prev" id="lightboxPrev">
            <i class="fas fa-chevron-left"></i>
        </button>
        <button class="lightbox-nav lightbox-next" id="lightboxNext">
            <i class="fas fa-chevron-right"></i>
        </button>
        <div class="lightbox-content">
            <img src="" alt="" class="lightbox-img" id="lightboxImg">
        </div>
    </div>

    <!-- ===== FIREBASE CONFIGURATION ===== -->
    <script type="module">
        // Import Firebase functions
        import { 
            db, 
            doc, 
            getDoc,
            collection,
            query,
            where,
            getDocs,
            limit
        } from './firebase-config.js';

        // ===== GLOBAL VARIABLES =====
        let currentProduct = null;
        let currentImageIndex = 0;
        let selectedSize = null;
        let selectedColor = null;
        let selectedFinish = null;
        let quantity = 1;
        let relatedProducts = [];

        // ===== DOM ELEMENTS =====
        const loadingState = document.getElementById('loadingState');
        const errorState = document.getElementById('errorState');
        const productContent = document.getElementById('productContent');
        const relatedProductsSection = document.getElementById('relatedProductsSection');
        
        const mainProductImage = document.getElementById('mainProductImage');
        const mainImageContainer = document.getElementById('mainImageContainer');
        const zoomLens = document.getElementById('zoomLens');
        const zoomResult = document.getElementById('zoomResult');
        const zoomResultImg = document.getElementById('zoomResultImg');
        const thumbnailStrip = document.getElementById('thumbnailStrip');
        
        const productTitle = document.getElementById('productTitle');
        const productPrice = document.getElementById('productPrice');
        const priceUnit = document.getElementById('priceUnit');
        const productRating = document.getElementById('productRating');
        const ratingCount = document.getElementById('ratingCount');
        const productDescription = document.getElementById('productDescription');
        const productOptions = document.getElementById('productOptions');
        const specificationsTable = document.getElementById('specificationsTable');
        
        const quantityInput = document.getElementById('quantityInput');
        const quantityDecrease = document.getElementById('quantityDecrease');
        const quantityIncrease = document.getElementById('quantityIncrease');
        const totalPrice = document.getElementById('totalPrice');
        const addToCartBtn = document.getElementById('addToCartBtn');
        const buyNowBtn = document.getElementById('buyNowBtn');
        
        const relatedProductsSlider = document.getElementById('relatedProductsSlider');
        const sliderPrevBtn = document.getElementById('sliderPrevBtn');
        const sliderNextBtn = document.getElementById('sliderNextBtn');
        
        const lightbox = document.getElementById('lightbox');
        const lightboxImg = document.getElementById('lightboxImg');
        const lightboxClose = document.getElementById('lightboxClose');
        const lightboxPrev = document.getElementById('lightboxPrev');
        const lightboxNext = document.getElementById('lightboxNext');

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üöÄ Initializing Product Details Page...');
            
            // Get product ID from URL
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id') || localStorage.getItem('selectedProductId');
            
            if (!productId) {
                showError("No product ID found in URL");
                return;
            }
            
            console.log('üìã Product ID:', productId);
            
            try {
                // Load product from Firebase
                await loadProductFromFirestore(productId);
                
                // Initialize UI after product is loaded
                initializeProductPage();
                initializeImageZoom();
                initializeLightbox();
                initializeQuantityControls();
                initializeActionButtons();
                initializeRelatedProductsSlider();
                
                console.log('‚úÖ Product Page initialized successfully!');
            } catch (error) {
                console.error('‚ùå Error loading product:', error);
                showError("Failed to load product details");
            }
        });

        // ===== FIREBASE FUNCTIONS =====
        async function loadProductFromFirestore(productId) {
            try {
                console.log('üî• Loading product from Firestore...');
                
                // Get product document
                const docRef = doc(db, "products", productId);
                const docSnap = await getDoc(docRef);
                
                if (!docSnap.exists()) {
                    throw new Error("Product not found");
                }
                
                // Get product data
                let productData = docSnap.data();
                
                // ‚úÖ FIX: Handle additional_fields array properly
                if (productData.additional_fields && Array.isArray(productData.additional_fields)) {
                    productData.additional_fields.forEach(field => {
                        if (field && typeof field === 'object') {
                            productData = { ...productData, ...field };
                        }
                    });
                }
                
                // Set current product
                currentProduct = {
                    id: docSnap.id,
                    ...productData
                };
                
                console.log('‚úÖ Product loaded:', currentProduct);
                
                // Hide loading, show content
                loadingState.style.display = 'none';
                productContent.classList.remove('hidden');
                
                // Load related products
                await loadRelatedProducts();
                
            } catch (error) {
                console.error('‚ùå Error loading product from Firestore:', error);
                throw error;
            }
        }

        async function loadRelatedProducts() {
            try {
                if (!currentProduct) return;
                
                console.log('üîÑ Loading related products...');
                
                // Get products from same category or uses
                const q = query(
                    collection(db, "products"),
                    where("id", "!=", currentProduct.id),
                    limit(6)
                );
                
                const querySnapshot = await getDocs(q);
                relatedProducts = [];
                
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    let processedData = { ...data };
                    
                    // Handle additional_fields
                    if (data.additional_fields && Array.isArray(data.additional_fields)) {
                        data.additional_fields.forEach(field => {
                            if (field && typeof field === 'object') {
                                processedData = { ...processedData, ...field };
                            }
                        });
                    }
                    
                    relatedProducts.push({
                        id: doc.id,
                        ...processedData
                    });
                });
                
                console.log('‚úÖ Related products loaded:', relatedProducts.length);
                
                // If no related products found, use sample data as fallback
                if (relatedProducts.length === 0) {
                    relatedProducts = getSampleRelatedProducts();
                }
                
                // Show related products section
                relatedProductsSection.classList.remove('hidden');
                
            } catch (error) {
                console.error('‚ùå Error loading related products:', error);
                // Use sample data as fallback
                relatedProducts = getSampleRelatedProducts();
                relatedProductsSection.classList.remove('hidden');
            }
        }

        // ===== PRODUCT PAGE FUNCTIONS =====
        function initializeProductPage() {
            if (!currentProduct) {
                showError("No product data available");
                return;
            }
            
            // Set product title
            productTitle.textContent = currentProduct.stone_name || "Stone Product";
            
            // Set product price
            const price = parseFloat(currentProduct.price) || 0;
            const unit = currentProduct.price_unit || "per unit";
            productPrice.innerHTML = `¬£${price.toFixed(2)} <span id="priceUnit">${unit}</span>`;
            
            // Set product description
            productDescription.textContent = currentProduct.description || "No description available";
            
            // Set rating (use sample rating if not available)
            const rating = currentProduct.rating || 4.5;
            const reviewCount = currentProduct.review_count || 128;
            updateRatingStars(rating);
            ratingCount.textContent = `(${rating}/5 from ${reviewCount} reviews)`;
            
            // Create thumbnail strip
            createThumbnailStrip();
            
            // Create product options
            createProductOptions();
            
            // Create specifications table
            createSpecificationsTable();
            
            // Update total price
            updateTotalPrice();
            
            // Update page title
            document.title = `${currentProduct.stone_name || 'Product'} - StoneCraft UK`;
        }

        function createThumbnailStrip() {
            thumbnailStrip.innerHTML = '';
            
            // Get images from product
            const images = getProductImages();
            
            if (images.length === 0) {
                // Use default image if no images available
                const defaultImage = getDefaultImage(currentProduct.category);
                images.push({
                    thumb: defaultImage,
                    main: defaultImage,
                    zoom: defaultImage
                });
            }
            
            // Set main image
            if (images[0]) {
                mainProductImage.src = images[0].main;
                zoomResultImg.src = images[0].zoom;
            }
            
            // Create thumbnails
            images.forEach((image, index) => {
                const thumbnailItem = document.createElement('div');
                thumbnailItem.className = 'thumbnail-item';
                if (index === 0) thumbnailItem.classList.add('active');
                
                thumbnailItem.innerHTML = `
                    <img src="${image.thumb}" alt="Thumbnail ${index + 1}" class="thumbnail-img">
                `;
                
                thumbnailItem.addEventListener('click', () => {
                    updateMainImage(index);
                    updateActiveThumbnail(index);
                });
                
                thumbnailItem.addEventListener('mouseenter', () => {
                    if (index !== currentImageIndex) {
                        mainProductImage.src = images[index].main;
                    }
                });
                
                thumbnailItem.addEventListener('mouseleave', () => {
                    mainProductImage.src = images[currentImageIndex].main;
                });
                
                thumbnailStrip.appendChild(thumbnailItem);
            });
        }

        function getProductImages() {
            const images = [];
            
            // Check for images array
            if (currentProduct.images && Array.isArray(currentProduct.images)) {
                currentProduct.images.forEach((img, index) => {
                    if (typeof img === 'string') {
                        images.push({
                            thumb: img,
                            main: img,
                            zoom: img
                        });
                    }
                });
            }
            
            // Check for single image field
            if (currentProduct.image && images.length === 0) {
                images.push({
                    thumb: currentProduct.image,
                    main: currentProduct.image,
                    zoom: currentProduct.image
                });
            }
            
            return images;
        }

        function getDefaultImage(category) {
            const defaultImages = {
                'marble': 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=400&q=80',
                'granite': 'https://images.unsplash.com/photo-1595428774223-ef52624120d2?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=400&q=80',
                'limestone': 'https://images.unsplash.com/photo-1611273426858-450d8e3c9fce?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=400&q=80',
                'sandstone': 'https://images.unsplash.com/photo-1541140532154-b024d705b90a?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=400&q=80',
                'red sand stone': 'https://i.ibb.co/HLpBc94R/51b7aaab131a.jpg'
            };
            
            const cat = (category || 'marble').toLowerCase();
            return defaultImages[cat] || defaultImages.marble;
        }

        function updateMainImage(index) {
            const images = getProductImages();
            if (!images[index]) return;
            
            currentImageIndex = index;
            mainProductImage.src = images[index].main;
            zoomResultImg.src = images[index].zoom;
            
            // Add fade-in animation
            mainProductImage.classList.add('fade-in');
            setTimeout(() => {
                mainProductImage.classList.remove('fade-in');
            }, 500);
        }

        function updateActiveThumbnail(index) {
            const thumbnails = document.querySelectorAll('.thumbnail-item');
            thumbnails.forEach((thumb, i) => {
                if (i === index) {
                    thumb.classList.add('active');
                } else {
                    thumb.classList.remove('active');
                }
            });
        }

        function updateRatingStars(rating) {
            productRating.innerHTML = '';
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;
            
            // Add full stars
            for (let i = 0; i < fullStars; i++) {
                productRating.innerHTML += '<i class="fas fa-star"></i>';
            }
            
            // Add half star
            if (hasHalfStar) {
                productRating.innerHTML += '<i class="fas fa-star-half-alt"></i>';
            }
            
            // Add empty stars
            const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
            for (let i = 0; i < emptyStars; i++) {
                productRating.innerHTML += '<i class="far fa-star"></i>';
            }
        }

        function createProductOptions() {
            productOptions.innerHTML = '';
            
            // Create size options if available
            if (currentProduct.size || currentProduct.thickness) {
                const sizeGroup = document.createElement('div');
                sizeGroup.className = 'option-group';
                sizeGroup.innerHTML = `
                    <div class="option-title">Size / Thickness</div>
                    <div class="option-list" id="sizeOptions">
                        <div class="option-item selected" data-size="default">
                            ${currentProduct.size || 'Standard'} - ${currentProduct.thickness || 'Standard'}
                        </div>
                    </div>
                `;
                productOptions.appendChild(sizeGroup);
                
                selectedSize = 'default';
            }
            
            // Create color options if available
            if (currentProduct.color) {
                const colorGroup = document.createElement('div');
                colorGroup.className = 'option-group';
                colorGroup.innerHTML = `
                    <div class="option-title">Color</div>
                    <div class="option-list" id="colorOptions">
                        <div class="option-item color-option selected" 
                             data-color="${currentProduct.color}" 
                             style="background-color: ${getColorHex(currentProduct.color)}"
                             title="${currentProduct.color}">
                        </div>
                    </div>
                `;
                productOptions.appendChild(colorGroup);
                
                selectedColor = currentProduct.color;
            }
            
            // Create finish options if available
            if (currentProduct.finish) {
                const finishGroup = document.createElement('div');
                finishGroup.className = 'option-group';
                finishGroup.innerHTML = `
                    <div class="option-title">Finish</div>
                    <div class="option-list" id="finishOptions">
                        <div class="option-item selected" data-finish="${currentProduct.finish}">
                            ${currentProduct.finish}
                        </div>
                    </div>
                `;
                productOptions.appendChild(finishGroup);
                
                selectedFinish = currentProduct.finish;
            }
        }

        function getColorHex(colorName) {
            const colorMap = {
                'red': '#ff0000',
                'white': '#ffffff',
                'black': '#000000',
                'gray': '#808080',
                'grey': '#808080',
                'blue': '#0000ff',
                'green': '#008000',
                'yellow': '#ffff00',
                'brown': '#a52a2a',
                'beige': '#f5f5dc',
                'tan': '#d2b48c'
            };
            
            const normalizedColor = (colorName || '').toLowerCase();
            return colorMap[normalizedColor] || '#cccccc';
        }

        function createSpecificationsTable() {
            specificationsTable.innerHTML = '';
            
            // Add specifications from product data
            const specFields = [
                { key: 'Category', value: currentProduct.category },
                { key: 'Type', value: currentProduct.type },
                { key: 'Color', value: currentProduct.color },
                { key: 'Size', value: currentProduct.size },
                { key: 'Thickness', value: currentProduct.thickness },
                { key: 'Length', value: currentProduct.length },
                { key: 'Width', value: currentProduct.width },
                { key: 'Uses', value: currentProduct.uses },
                { key: 'Density', value: currentProduct.density },
                { key: 'Finish', value: currentProduct.finish },
                { key: 'Water Absorption', value: currentProduct.water_absorption },
                { key: 'Compressive Strength', value: currentProduct.compressive_strength },
                { key: 'Factory Name', value: currentProduct.factory_name },
                { key: 'Contact', value: currentProduct.contact_number }
            ];
            
            specFields.forEach(spec => {
                if (spec.value) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${spec.key}</td>
                        <td>${spec.value}</td>
                    `;
                    specificationsTable.appendChild(row);
                }
            });
            
            // If no specifications found, show message
            if (specificationsTable.children.length === 0) {
                specificationsTable.innerHTML = `
                    <tr>
                        <td colspan="2" style="text-align: center; padding: 30px; color: #666;">
                            No specifications available for this product.
                        </td>
                    </tr>
                `;
            }
        }

        // ‚úÖ FIXED: IMAGE ZOOM FUNCTIONALITY
        function initializeImageZoom() {
            if (!mainImageContainer || !zoomLens || !zoomResult) return;
            
            const zoomFactor = 2;
            let isZooming = false;
            
            // Initialize lens size
            updateLensSize();
            
            // Mouse events
            mainImageContainer.addEventListener('mouseenter', () => {
                isZooming = true;
                zoomLens.style.display = 'block';
                zoomResult.style.display = 'block';
                updateZoomPosition();
            });
            
            mainImageContainer.addEventListener('mouseleave', () => {
                isZooming = false;
                zoomLens.style.display = 'none';
                zoomResult.style.display = 'none';
            });
            
            mainImageContainer.addEventListener('mousemove', (e) => {
                if (!isZooming) return;
                updateZoomPosition(e);
            });
            
            // Touch events for mobile
            mainImageContainer.addEventListener('touchstart', (e) => {
                e.preventDefault();
                isZooming = true;
                zoomLens.style.display = 'block';
                zoomResult.style.display = 'block';
                updateZoomPositionTouch(e);
            });
            
            mainImageContainer.addEventListener('touchmove', (e) => {
                if (!isZooming) return;
                e.preventDefault();
                updateZoomPositionTouch(e);
            });
            
            mainImageContainer.addEventListener('touchend', () => {
                isZooming = false;
                zoomLens.style.display = 'none';
                zoomResult.style.display = 'none';
            });
            
            // Open lightbox on image click
            mainImageContainer.addEventListener('click', () => {
                openLightbox(currentImageIndex);
            });
            
            // Adjust on window resize
            window.addEventListener('resize', updateLensSize);
            
            function updateLensSize() {
                const containerWidth = mainImageContainer.offsetWidth;
                const lensSize = Math.min(150, containerWidth / 3);
                
                zoomLens.style.width = lensSize + 'px';
                zoomLens.style.height = lensSize + 'px';
                
                zoomResult.style.width = lensSize + 'px';
                zoomResult.style.height = lensSize + 'px';
            }
            
            function updateZoomPosition(e = null) {
                if (!e) return;
                
                const containerRect = mainImageContainer.getBoundingClientRect();
                const imgRect = mainProductImage.getBoundingClientRect();
                
                // Calculate cursor position relative to image
                let x = e.clientX - imgRect.left;
                let y = e.clientY - imgRect.top;
                
                // Get lens dimensions
                const lensWidth = zoomLens.offsetWidth;
                const lensHeight = zoomLens.offsetHeight;
                
                // Calculate bounds
                const minX = lensWidth / 2;
                const maxX = imgRect.width - lensWidth / 2;
                const minY = lensHeight / 2;
                const maxY = imgRect.height - lensHeight / 2;
                
                // Clamp position within image bounds
                x = Math.max(minX, Math.min(x, maxX));
                y = Math.max(minY, Math.min(y, maxY));
                
                // Position the lens
                zoomLens.style.left = (x - lensWidth / 2) + 'px';
                zoomLens.style.top = (y - lensHeight / 2) + 'px';
                
                // Calculate zoomed image position
                const zoomX = ((x - minX) / (maxX - minX)) * 100;
                const zoomY = ((y - minY) / (maxY - minY)) * 100;
                
                // Position the zoomed image
                zoomResultImg.style.objectPosition = `${zoomX}% ${zoomY}%`;
            }
            
            function updateZoomPositionTouch(e) {
                if (!e.touches || e.touches.length === 0) return;
                
                const touch = e.touches[0];
                const fakeEvent = {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                };
                
                updateZoomPosition(fakeEvent);
            }
        }

        // ===== LIGHTBOX FUNCTIONALITY =====
        function initializeLightbox() {
            if (!lightbox || !lightboxImg) return;
            
            // Close lightbox
            lightboxClose.addEventListener('click', closeLightbox);
            
            // Close on background click
            lightbox.addEventListener('click', (e) => {
                if (e.target === lightbox) {
                    closeLightbox();
                }
            });
            
            // Close on Escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && lightbox.classList.contains('active')) {
                    closeLightbox();
                }
            });
            
            // Navigation
            lightboxPrev.addEventListener('click', () => {
                navigateLightbox(-1);
            });
            
            lightboxNext.addEventListener('click', () => {
                navigateLightbox(1);
            });
            
            // Keyboard navigation
            document.addEventListener('keydown', (e) => {
                if (!lightbox.classList.contains('active')) return;
                
                if (e.key === 'ArrowLeft') {
                    navigateLightbox(-1);
                } else if (e.key === 'ArrowRight') {
                    navigateLightbox(1);
                }
            });
        }

        function openLightbox(index) {
            const images = getProductImages();
            if (!images[index]) return;
            
            currentImageIndex = index;
            lightboxImg.src = images[index].main;
            lightbox.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeLightbox() {
            lightbox.classList.remove('active');
            document.body.style.overflow = '';
        }

        function navigateLightbox(direction) {
            const images = getProductImages();
            let newIndex = currentImageIndex + direction;
            
            // Wrap around
            if (newIndex < 0) {
                newIndex = images.length - 1;
            } else if (newIndex >= images.length) {
                newIndex = 0;
            }
            
            currentImageIndex = newIndex;
            lightboxImg.src = images[newIndex].main;
            
            // Add fade-in animation
            lightboxImg.classList.add('fade-in');
            setTimeout(() => {
                lightboxImg.classList.remove('fade-in');
            }, 300);
        }

        // ===== QUANTITY CONTROLS =====
        function initializeQuantityControls() {
            // Set initial quantity
            quantity = 1;
            quantityInput.value = quantity;
            
            // Decrease quantity
            quantityDecrease.addEventListener('click', () => {
                if (quantity > 1) {
                    quantity--;
                    quantityInput.value = quantity;
                    updateTotalPrice();
                }
            });
            
            // Increase quantity
            quantityIncrease.addEventListener('click', () => {
                if (quantity < 100) {
                    quantity++;
                    quantityInput.value = quantity;
                    updateTotalPrice();
                }
            });
            
            // Manual input
            quantityInput.addEventListener('change', () => {
                let value = parseInt(quantityInput.value);
                
                if (isNaN(value) || value < 1) {
                    value = 1;
                } else if (value > 100) {
                    value = 100;
                }
                
                quantity = value;
                quantityInput.value = quantity;
                updateTotalPrice();
            });
        }

        function updateTotalPrice() {
            if (!currentProduct) return;
            
            const price = parseFloat(currentProduct.price) || 0;
            const total = (price * quantity).toFixed(2);
            totalPrice.textContent = total;
        }

        // ===== ACTION BUTTONS =====
        function initializeActionButtons() {
            // Add to Cart
            addToCartBtn.addEventListener('click', () => {
                addToCart();
            });
            
            // Buy Now
            buyNowBtn.addEventListener('click', () => {
                buyNow();
            });
        }

        function addToCart() {
            if (!currentProduct) return;
            
            const product = {
                id: currentProduct.id,
                name: currentProduct.stone_name,
                price: parseFloat(currentProduct.price) || 0,
                size: selectedSize,
                color: selectedColor,
                finish: selectedFinish,
                quantity: quantity,
                image: getProductImages()[0]?.thumb || getDefaultImage(currentProduct.category)
            };
            
            console.log('Added to cart:', product);
            
            // Show confirmation
            const originalText = addToCartBtn.innerHTML;
            addToCartBtn.innerHTML = '<i class="fas fa-check"></i> Added to Cart!';
            addToCartBtn.style.background = '#28a745';
            
            setTimeout(() => {
                addToCartBtn.innerHTML = originalText;
                addToCartBtn.style.background = '';
            }, 2000);
            
            // Save to cart
            saveToCart(product);
        }

        function buyNow() {
            // First add to cart
            addToCart();
            
            // Then redirect to checkout
            console.log('Proceeding to checkout...');
            // window.location.href = '/checkout.html';
        }

        function saveToCart(product) {
            // Get existing cart or create new one
            let cart = JSON.parse(localStorage.getItem('stonecraft_cart')) || [];
            
            // Check if product already in cart
            const existingIndex = cart.findIndex(item => 
                item.id === product.id && 
                item.size === product.size && 
                item.color === product.color && 
                item.finish === product.finish
            );
            
            if (existingIndex > -1) {
                // Update quantity
                cart[existingIndex].quantity += product.quantity;
            } else {
                // Add new item
                cart.push(product);
            }
            
            // Save to localStorage
            localStorage.setItem('stonecraft_cart', JSON.stringify(cart));
            
            // Update cart count in header
            updateCartCount(cart.length);
        }

        function updateCartCount(count) {
            const cartCountElements = document.querySelectorAll('.user-action span');
            cartCountElements.forEach(element => {
                if (element.textContent.includes('Cart')) {
                    element.textContent = `Cart (${count})`;
                }
            });
        }

        // ===== RELATED PRODUCTS SLIDER =====
        function initializeRelatedProductsSlider() {
            createRelatedProductsSlider();
            initializeSliderControls();
        }

        function createRelatedProductsSlider() {
            relatedProductsSlider.innerHTML = '';
            
            if (relatedProducts.length === 0) return;
            
            relatedProducts.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'related-product-card';
                productCard.dataset.productId = product.id;
                
                const imageUrl = product.image || product.images?.[0] || getDefaultImage(product.category);
                const productName = product.stone_name || 'Stone Product';
                const productPrice = parseFloat(product.price) || 0;
                
                productCard.innerHTML = `
                    <div class="related-product-img-container">
                        <img src="${imageUrl}" alt="${productName}" class="related-product-img">
                    </div>
                    <div class="related-product-info">
                        <h3 class="related-product-title">${productName}</h3>
                        <div class="related-product-price">¬£${productPrice.toFixed(2)}</div>
                    </div>
                `;
                
                // Add click event to redirect to product details
                productCard.addEventListener('click', () => {
                    redirectToProductDetails(product.id, productName);
                });
                
                relatedProductsSlider.appendChild(productCard);
            });
        }

        function redirectToProductDetails(productId, productName) {
            // Save product ID to localStorage
            localStorage.setItem('selectedProductId', productId);
            
            // Create SEO-friendly URL
            const slug = (productName || 'product').toLowerCase()
                .replace(/[^\w\s]/gi, '')
                .replace(/\s+/g, '-');
            
            // Redirect to product details page
            window.location.href = `product-details.html?id=${productId}&name=${slug}`;
        }

        function initializeSliderControls() {
            let scrollPosition = 0;
            const scrollAmount = 300;
            
            sliderPrevBtn.addEventListener('click', () => {
                relatedProductsSlider.scrollLeft -= scrollAmount;
                updateSliderButtons();
            });
            
            sliderNextBtn.addEventListener('click', () => {
                relatedProductsSlider.scrollLeft += scrollAmount;
                updateSliderButtons();
            });
            
            // Update button states on scroll
            relatedProductsSlider.addEventListener('scroll', updateSliderButtons);
            
            // Initial button state
            updateSliderButtons();
        }

        function updateSliderButtons() {
            const scrollLeft = relatedProductsSlider.scrollLeft;
            const scrollWidth = relatedProductsSlider.scrollWidth;
            const clientWidth = relatedProductsSlider.clientWidth;
            
            sliderPrevBtn.disabled = scrollLeft <= 0;
            sliderNextBtn.disabled = scrollLeft + clientWidth >= scrollWidth - 10;
        }

        // ===== UTILITY FUNCTIONS =====
        function showError(message) {
            loadingState.style.display = 'none';
            errorState.classList.remove('hidden');
            
            if (message) {
                errorState.querySelector('h3').textContent = message;
            }
        }

        function getSampleRelatedProducts() {
            return [
                {
                    id: "2",
                    stone_name: "Black Galaxy Granite",
                    category: "Granite",
                    price: 89.99,
                    image: "https://images.unsplash.com/photo-1595428774223-ef52624120d2?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=400&q=80"
                },
                {
                    id: "3",
                    stone_name: "Travertine Beige Stone",
                    category: "Limestone",
                    price: 75.50,
                    image: "https://images.unsplash.com/photo-1611273426858-450d8e3c9fce?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=400&q=80"
                },
                {
                    id: "4",
                    stone_name: "Sandstone Pavers",
                    category: "Sandstone",
                    price: 45.25,
                    image: "https://images.unsplash.com/photo-1541140532154-b024d705b90a?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=400&q=80"
                },
                {
                    id: "5",
                    stone_name: "Quartzite Countertop",
                    category: "Quartzite",
                    price: 135.00,
                    image: "https://images.unsplash.com/photo-1592925300427-f58aa8f5b5ae?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=400&q=80"
                }
            ];
        }

        console.log('‚úÖ All functions defined successfully!');
    </script>
</body>
</html>
