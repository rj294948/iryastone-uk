<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details - StoneCraft UK</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ===== REUSE MOST STYLES FROM CATEGORY PAGE ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #ffffff;
            color: #333;
            line-height: 1.6;
            padding-top: 120px;
            transition: padding-top 0.3s ease;
        }
        
        body.scrolled-down {
            padding-top: 180px;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 5px 15px;
        }
        
        /* ===== MOBILE SIDEBAR MENU ===== */
        .mobile-uses-menu {
            position: fixed;
            top: 0;
            left: -320px;
            width: 300px;
            height: 100vh;
            background: white;
            box-shadow: 2px 0 15px rgba(0,0,0,0.15);
            z-index: 1100;
            transition: left 0.3s ease;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        
        .mobile-uses-menu.active {
            left: 0;
        }
        
        .mobile-menu-header {
            padding: 20px;
            background: #333;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #444;
        }
        
        .mobile-menu-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
        }
        
        .close-menu {
            background: none;
            border: none;
            color: white;
            font-size: 22px;
            cursor: pointer;
            padding: 5px;
        }
        
        .mobile-uses-list {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            max-height: calc(100vh - 70px);
        }
        
        .mobile-use-item {
            margin-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .mobile-use-link {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 10px;
            text-decoration: none;
            color: #333;
            font-weight: 500;
            font-size: 15px;
            cursor: pointer;
            border-radius: 6px;
            transition: background-color 0.3s;
            width: 100%;
            text-align: left;
        }
        
        .mobile-use-link:hover {
            background: #f8f9fa;
        }
        
        .mobile-use-link i {
            font-size: 12px;
            transition: transform 0.3s;
        }
        
        .mobile-mega-content {
            padding: 10px;
            display: none;
            background: #f8f9fa;
            border-radius: 6px;
            margin: 8px 0;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .mobile-mega-content.active {
            display: block;
        }
        
        .mobile-pattern-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .mobile-pattern-item {
            text-decoration: none;
            color: #333;
            display: block;
            transition: transform 0.2s;
        }
        
        .mobile-pattern-item:hover {
            transform: scale(1.02);
        }
        
        .mobile-pattern-image {
            width: 100%;
            height: 80px;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            border-radius: 5px;
            margin-bottom: 5px;
            background-color: #f0f0f0;
        }
        
        .mobile-pattern-name {
            font-size: 12px;
            text-align: center;
            color: #333;
            font-weight: 500;
            line-height: 1.3;
            padding: 0 5px;
        }
        
        /* Loading State for Mobile Menu */
        .loading-categories {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 14px;
        }
        
        .loading-categories i {
            display: block;
            margin-bottom: 10px;
            font-size: 24px;
            color: #b8860b;
        }
        
        /* Overlay for mobile menu */
        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1099;
            display: none;
        }
        
        .menu-overlay.active {
            display: block;
        }
        
        /* Header Styles */
        header {
            background-color: #fff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            transition: transform 0.4s ease;
            margin-top: 0;
            padding-top: 0;
        }
        
        header.hidden {
            transform: translateY(-100%);
        }
        
        header.visible {
            transform: translateY(0);
        }
        
        .main-header {
            padding: 5px 0;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
        }
        
        .logo h1 {
            font-size: 24px;
            color: #333;
            font-weight: 700;
        }
        
        .logo span {
            color: #b8860b;
        }
        
        .trust-info {
            flex: 1;
            text-align: center;
            padding: 0 10px;
            margin-top: 0;
            padding-top: 5px;
            position: relative;
        }
        
        .trust-info-content {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            font-size: 13px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 5px 10px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }
        
        /* Mobile Menu Toggle in Trust Info Section */
        .trust-mobile-toggle {
            display: none;
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            font-size: 20px;
            color: #333;
            cursor: pointer;
            z-index: 10;
            padding: 8px;
        }
        
        .trust-item {
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 6px;
        }
        
        .trust-item i {
            color: #b8860b;
            font-size: 14px;
        }

        /* User Profile Styles */
        .user-profile {
            position: relative;
        }

        .profile-toggle {
            display: flex;
            align-items: center;
            gap: 6px;
            background: none;
            border: none;
            cursor: pointer;
            padding: 6px 10px;
            border-radius: 6px;
            transition: background-color 0.3s;
        }

        .profile-toggle:hover {
            background: #f8f9fa;
        }

        .profile-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: #b8860b;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 12px;
        }

        .profile-name {
            font-size: 12px;
            font-weight: 500;
            color: #333;
        }

        .profile-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            min-width: 180px;
            z-index: 1000;
            display: none;
            border: 1px solid #e0e0e0;
        }

        .profile-dropdown.active {
            display: block;
        }

        .dropdown-header {
            padding: 12px;
            border-bottom: 1px solid #eee;
            background: #f8f9fa;
            border-radius: 8px 8px 0 0;
        }

        .dropdown-header .user-email {
            font-size: 11px;
            color: #666;
            margin-top: 4px;
        }

        .dropdown-menu {
            list-style: none;
            padding: 6px 0;
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            color: #333;
            text-decoration: none;
            font-size: 13px;
            transition: all 0.3s;
        }

        .dropdown-item:hover {
            background: #f8f9fa;
            color: #b8860b;
        }

        .dropdown-item i {
            width: 14px;
            text-align: center;
            color: #666;
            font-size: 13px;
        }

        .dropdown-divider {
            height: 1px;
            background: #eee;
            margin: 6px 0;
        }

        .user-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-action {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: #555;
            font-size: 11px;
            transition: color 0.3s;
            position: relative;
        }

        .user-action:hover {
            color: #b8860b;
        }

        .user-action i {
            font-size: 18px;
            margin-bottom: 2px;
        }

        /* Cart Badge */
        .cart-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #b8860b;
            color: white;
            font-size: 10px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Advanced Search Styles */
        .search-container {
            position: relative;
            flex: 1;
            max-width: 450px;
            margin: 0 15px;
        }

        .search-input-container {
            position: relative;
            display: flex;
            align-items: center;
        }

        .search-input {
            width: 100%;
            padding: 10px 40px 10px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 20px;
            font-size: 13px;
            background-color: #f8f9fa;
        }

        .search-input:focus {
            outline: none;
            border-color: #b8860b;
            background-color: white;
        }

        .search-button {
            position: absolute;
            right: 6px;
            background: #b8860b;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            max-height: 350px;
            overflow-y: auto;
            z-index: 1001;
            display: none;
            margin-top: 5px;
        }

        .search-results.active {
            display: block;
        }

        .search-result-item {
            display: flex;
            align-items: center;
            padding: 10px 12px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
        }

        .search-result-item:hover {
            background: #f8f9fa;
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .search-result-image {
            width: 45px;
            height: 45px;
            border-radius: 6px;
            background-size: cover;
            background-position: center;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .search-result-content {
            flex: 1;
        }

        .search-result-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 3px;
            font-size: 13px;
        }

        .search-result-category {
            font-size: 11px;
            color: #b8860b;
            background: #fff9e6;
            padding: 2px 6px;
            border-radius: 10px;
            display: inline-block;
        }

        .search-result-price {
            font-weight: 700;
            color: #b8860b;
            font-size: 13px;
        }

        .no-results {
            padding: 15px;
            text-align: center;
            color: #666;
            font-size: 13px;
        }

        .search-loading {
            padding: 12px;
            text-align: center;
            color: #666;
            font-size: 13px;
        }

        .view-all-results {
            padding: 10px 12px;
            text-align: center;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
            font-size: 13px;
        }

        .view-all-results a {
            color: #b8860b;
            text-decoration: none;
            font-weight: 600;
        }
        
        /* Banner Text */
        .banner-text {
            background: linear-gradient(135deg, #b8860b, #a3780a);
            color: white;
            padding: 2px 0;
            text-align: center;
            font-size: 12px;
            font-weight: 500;
            margin: 0;
            line-height: 1.2;
        }
        
        /* ===== DESKTOP USES TOP BAR ===== */
        .uses-top-bar {
            position: fixed;
            top: 120px;
            left: 0;
            width: 100%;
            background: #333;
            padding: 0;
            z-index: 999;
            transition: top 0.3s ease;
        }
        
        body.scrolled-down .uses-top-bar {
            top: 0;
        }
        
        .uses-container {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
        }
        
        .use-item {
            flex: 1;
            min-width: 110px;
            position: relative; 
        }
        
        .use-link {
            display: block;
            color: white;
            text-decoration: none;
            padding: 12px 8px;
            font-size: 13px;
            font-weight: 500;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .use-link:hover {
            background: #b8860b;
        }
        
        /* Mega Menu Styles */
        .mega-menu {
            position: absolute;
            top: 100%;
            left: 0; 
            width: 100%; 
            background: white;
            z-index: 1000;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            display: none; 
            padding: 25px 0;
        }
        
        .use-item:hover .mega-menu {
            display: block;
        }
        
        .patterns-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 15px;
            padding: 0 15px;
        }
        
        .pattern-item {
            text-align: center;
            cursor: pointer;
            text-decoration: none;
            color: #333;
        }
        
        .pattern-image {
            width: 100%;
            height: 160px;
            background-size: cover;
            background-position: center;
            border-radius: 6px;
            margin-bottom: 8px;
            transition: transform 0.3s ease;
        }
        
        .pattern-item:hover .pattern-image {
            transform: scale(1.05);
        }
        
        .pattern-name {
            font-size: 13px;
            color: #333;
            font-weight: 500;
        }

        /* ===== PRODUCT DETAILS PAGE SPECIFIC STYLES ===== */
        .main-content {
            margin-top: 8px;
            padding: 2px 0px;
        }
        
        /* Page Header */
        .page-header {
            text-align: center;
            margin-bottom: 0px;
            padding: 22px 5px;
            background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('https://plus.unsplash.com/premium_photo-1673567871911-c8a8c63d1c2b?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8OXx8c3RvbmV8ZW58MHx8MHx8fDA%3D') center/cover;
            border-radius: 8px;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            margin-top: 1px;
        }
        
        .page-header h1 {
            font-size: 28px;
            color: white;
            margin-bottom: 5px;
            line-height: 1.2;
        }
        
        .page-header .breadcrumb {
            color: white;
            font-size: 14px;
            opacity: 0.9;
        }
        
        .page-header .breadcrumb a {
            color: #fff;
            text-decoration: none;
            font-weight: 500;
        }
        
        .page-header .breadcrumb span {
            margin: 0 8px;
            color: rgba(255,255,255,0.7);
        }
        
        /* Product Details Layout */
        .product-details-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin: 30px 0;
        }
        
        /* ENHANCED SMART ZOOM FEATURE */
        .product-gallery {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: relative;
            overflow: visible;
        }
        
        .main-image-container {
            width: 100%;
            aspect-ratio: 1 / 1;
            overflow: hidden;
            border-radius: 10px;
            margin-bottom: 15px;
            position: relative;
            cursor: zoom-in;
        }
        
        .main-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }
        
        .main-image-container:hover .main-image {
            transform: scale(1.02);
        }
        
        /* Enhanced Zoom Lens */
        .image-zoom-lens {
            position: absolute;
            border: 3px solid #b8860b;
            background: rgba(184, 134, 11, 0.15);
            pointer-events: none;
            display: none;
            z-index: 100;
            width: 180px;
            height: 180px;
            box-sizing: border-box;
            border-radius: 50%;
            box-shadow: 0 0 20px rgba(184, 134, 11, 0.3);
        }
        
        /* Enhanced Zoom Result */
        .image-zoom-result {
            position: fixed;
            top: 50%;
            right: 30px;
            transform: translateY(-50%);
            width: 450px;
            height: 450px;
            border: 3px solid #b8860b;
            border-radius: 12px;
            background: white;
            overflow: hidden;
            display: none;
            z-index: 1100;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            padding: 10px;
        }
        
        .image-zoom-result img {
            position: absolute;
            width: 1200px;
            height: 1200px;
            object-fit: none;
            border-radius: 8px;
        }
        
        .zoom-active .image-zoom-lens,
        .zoom-active .image-zoom-result {
            display: block;
        }
        
        /* Enhanced Zoom controls */
        .zoom-controls {
            position: absolute;
            bottom: 15px;
            right: 15px;
            display: flex;
            gap: 8px;
            z-index: 102;
        }
        
        .zoom-btn {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #ddd;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 16px;
            color: #333;
            transition: all 0.3s;
            box-shadow: 0 3px 10px rgba(0,0,0,0.15);
        }
        
        .zoom-btn:hover {
            background: #b8860b;
            color: white;
            border-color: #b8860b;
            transform: scale(1.1);
        }
        
        /* Click to open full image overlay */
        .full-image-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .full-image-overlay.active {
            display: flex;
        }
        
        .full-image-container {
            max-width: 90%;
            max-height: 90%;
            position: relative;
        }
        
        .full-image {
            width: 100%;
            height: auto;
            max-height: 90vh;
            object-fit: contain;
            border-radius: 10px;
        }
        
        .close-full-image {
            position: absolute;
            top: -40px;
            right: 0;
            background: #b8860b;
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .full-image-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(184, 134, 11, 0.8);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s;
        }
        
        .full-image-nav:hover {
            background: #a3780a;
        }
        
        .prev-image {
            left: -60px;
        }
        
        .next-image {
            right: -60px;
        }
        
        .image-counter {
            position: absolute;
            bottom: -40px;
            left: 0;
            color: white;
            font-size: 16px;
            text-align: center;
            width: 100%;
        }
        
        /* Click to zoom hint */
        .zoom-hint {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 101;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .zoom-hint i {
            font-size: 14px;
        }
        
        .thumbnail-gallery {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 10px 0;
        }
        
        .thumbnail {
            width: 80px;
            height: 80px;
            border-radius: 5px;
            cursor: pointer;
            object-fit: cover;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .thumbnail.active {
            border-color: #b8860b;
            box-shadow: 0 3px 10px rgba(184, 134, 11, 0.3);
        }
        
        .thumbnail:hover {
            transform: scale(1.05);
        }
        
        /* Product Info */
        .product-info {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .product-title {
            font-size: 32px;
            color: #333;
            margin-bottom: 10px;
        }
        
        .product-category {
            font-size: 16px;
            color: #b8860b;
            background: #fff9e6;
            padding: 5px 12px;
            border-radius: 20px;
            display: inline-block;
            margin-bottom: 20px;
            font-weight: 500;
        }
        
        .product-price {
            font-size: 36px;
            color: #b8860b;
            font-weight: 700;
            margin-bottom: 25px;
        }
        
        .product-price-unit {
            font-size: 16px;
            color: #666;
            font-weight: normal;
        }
        
        .product-description-full {
            font-size: 16px;
            line-height: 1.7;
            color: #555;
            margin-bottom: 30px;
        }
        
        /* ===== SPECIFICATIONS SECTION (FIRST) ===== */
        .specifications {
            margin: 30px 0;
            background: #f9f9f9;
            padding: 25px;
            border-radius: 10px;
            border: 1px solid #eee;
        }
        
        .specifications h3 {
            font-size: 20px;
            margin-bottom: 20px;
            color: #333;
            padding-bottom: 10px;
            border-bottom: 2px solid #b8860b;
        }
        
        .specs-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .specs-table tr {
            border-bottom: 1px solid #eee;
        }
        
        .specs-table td {
            padding: 12px 0;
        }
        
        .spec-label {
            font-weight: 600;
            color: #333;
            width: 40%;
        }
        
        .spec-value {
            color: #666;
        }
        
        /* ===== RATE SETUP SECTION (SECOND) ===== */
        .rate-setup-section {
            background: #fff9e6;
            padding: 25px;
            border-radius: 10px;
            border: 2px solid #ffd966;
            margin: 30px 0;
        }
        
        .rate-setup-title {
            font-size: 20px;
            margin-bottom: 20px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .rate-setup-title i {
            color: #b8860b;
        }
        
        .rate-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .rate-control-group {
            flex: 1;
            min-width: 200px;
        }
        
        .rate-control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        .rate-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .rate-input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
        }
        
        .rate-input:focus {
            outline: none;
            border-color: #b8860b;
        }
        
        .rate-unit {
            min-width: 80px;
            padding: 12px 15px;
            background: #f0f0f0;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            text-align: center;
        }
        
        /* Quantity Selector */
        .quantity-selector {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 20px 0;
        }
        
        .quantity-label {
            font-weight: 600;
            color: #333;
        }
        
        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .quantity-btn {
            width: 35px;
            height: 35px;
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            color: #333;
            transition: all 0.3s;
        }
        
        .quantity-btn:hover {
            background: #b8860b;
            color: white;
            border-color: #b8860b;
        }
        
        .quantity-input {
            width: 60px;
            height: 35px;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .unit-selector {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .unit-option {
            padding: 12px 20px;
            background: #f5f5f5;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
            min-width: 120px;
            text-align: center;
        }
        
        .unit-option.selected {
            background: #b8860b;
            color: white;
            border-color: #b8860b;
        }
        
        /* ===== SHOP NOW SYSTEM STYLES ===== */
        
        /* Shop Now Button */
        .shop-now-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 16px 30px;
            background: linear-gradient(135deg, #b8860b 0%, #a3780a 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(184, 134, 11, 0.3);
            width: 100%;
            margin-top: 20px;
        }

        .shop-now-btn:hover {
            background: linear-gradient(135deg, #a3780a 0%, #8d6c09 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(184, 134, 11, 0.4);
        }

        .shop-now-btn:active {
            transform: translateY(0);
        }

        .shop-now-btn i {
            font-size: 20px;
        }

        /* Quick Buy Section */
        .quick-buy-section {
            background: #f9f9f9;
            padding: 25px;
            border-radius: 12px;
            margin: 25px 0;
            border: 1px solid #eee;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }

        .quick-buy-title {
            font-size: 20px;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quick-buy-title i {
            color: #b8860b;
        }

        .quick-buy-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }

        .quick-buy-option {
            background: white;
            border: 2px solid #eee;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quick-buy-option:hover {
            border-color: #b8860b;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(184, 134, 11, 0.1);
        }

        .quick-buy-option.selected {
            border-color: #b8860b;
            background: #fff9e6;
        }

        .option-amount {
            font-size: 24px;
            font-weight: 700;
            color: #b8860b;
            margin-bottom: 5px;
        }

        .option-unit {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
        }

        .option-price {
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .option-savings {
            font-size: 12px;
            color: #4CAF50;
            background: #e8f5e9;
            padding: 3px 8px;
            border-radius: 10px;
            margin-top: 5px;
            display: inline-block;
        }

        /* Direct Buy Now Button */
        .buy-now-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 18px 30px;
            background: linear-gradient(135deg, #2E7D32 0%, #1B5E20 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(46, 125, 50, 0.3);
            width: 100%;
            margin-top: 10px;
        }

        .buy-now-btn:hover {
            background: linear-gradient(135deg, #1B5E20 0%, #0D3B13 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(46, 125, 50, 0.4);
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 15px 25px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            font-size: 16px;
            border: none;
            cursor: pointer;
        }
        
        .primary-btn {
            background: #b8860b;
            color: white;
            flex: 1;
        }
        
        .secondary-btn {
            background: #f0f0f0;
            color: #333;
            flex: 1;
        }
        
        .primary-btn:hover {
            background: #a3780a;
            transform: translateY(-2px);
        }
        
        .secondary-btn:hover {
            background: #e0e0e0;
            transform: translateY(-2px);
        }
        
        /* Contact Info */
        .contact-info {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
        }
        
        .contact-info h3 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #333;
        }
        
        .contact-details {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .contact-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            flex: 1;
            min-width: 200px;
        }
        
        .contact-item i {
            color: #b8860b;
            font-size: 18px;
        }
        
        /* ===== SHOP NOW POPUP MODAL ===== */
        .shop-now-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 3000;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .shop-now-modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.4s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 25px;
            background: #333;
            color: white;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 22px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
        }

        .modal-body {
            padding: 30px;
        }

        .modal-section {
            margin-bottom: 25px;
        }

        .modal-section h4 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #333;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-section h4 i {
            color: #b8860b;
        }

        .modal-input-group {
            margin-bottom: 15px;
        }

        .modal-input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .modal-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        .modal-input:focus {
            outline: none;
            border-color: #b8860b;
        }

        .modal-checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
        }

        .modal-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .modal-checkbox-label {
            font-size: 14px;
            color: #666;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .modal-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .modal-cancel {
            background: #f0f0f0;
            color: #333;
        }

        .modal-cancel:hover {
            background: #e0e0e0;
        }

        .modal-confirm {
            background: #b8860b;
            color: white;
        }

        .modal-confirm:hover {
            background: #a3780a;
        }

        .order-summary {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .summary-row.total {
            font-size: 18px;
            font-weight: 700;
            color: #333;
            border-bottom: none;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #b8860b;
        }

        .summary-label {
            color: #666;
        }

        .summary-value {
            font-weight: 600;
            color: #333;
        }

        .summary-value.total-price {
            color: #b8860b;
            font-size: 22px;
        }

        /* ===== CART SUMMARY SIDEBAR ===== */
        .cart-summary-sidebar {
            position: fixed;
            top: 0;
            right: -400px;
            width: 380px;
            height: 100vh;
            background: white;
            box-shadow: -5px 0 25px rgba(0,0,0,0.15);
            z-index: 2000;
            transition: right 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .cart-summary-sidebar.active {
            right: 0;
        }

        .cart-summary-header {
            padding: 20px;
            background: #333;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #444;
        }

        .cart-summary-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close-summary {
            background: none;
            border: none;
            color: white;
            font-size: 22px;
            cursor: pointer;
            padding: 5px;
        }

        .cart-summary-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .cart-item-summary {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .cart-item-image {
            width: 70px;
            height: 70px;
            border-radius: 6px;
            background-size: cover;
            background-position: center;
            flex-shrink: 0;
        }

        .cart-item-details {
            flex: 1;
        }

        .cart-item-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .cart-item-meta {
            font-size: 13px;
            color: #666;
        }

        .cart-summary-footer {
            padding: 20px;
            border-top: 1px solid #eee;
            background: white;
        }

        .summary-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .summary-total-price {
            color: #b8860b;
            font-size: 24px;
        }

        .summary-actions {
            display: flex;
            gap: 10px;
        }

        .summary-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .continue-shopping {
            background: #f0f0f0;
            color: #333;
        }

        .continue-shopping:hover {
            background: #e0e0e0;
        }

        .checkout-btn {
            background: #b8860b;
            color: white;
        }

        .checkout-btn:hover {
            background: #a3780a;
        }

        /* Overlay for cart sidebar */
        .cart-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1999;
            display: none;
        }

        .cart-overlay.active {
            display: block;
        }

        /* Add to Cart Success Notification */
        .add-to-cart-notification {
            position: fixed;
            top: 120px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 2001;
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateX(120%);
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            max-width: 350px;
        }

        .add-to-cart-notification.show {
            transform: translateX(0);
        }

        .notification-icon {
            font-size: 24px;
        }

        .notification-content {
            flex: 1;
        }

        .notification-content h4 {
            margin: 0 0 5px 0;
            font-size: 16px;
        }

        .notification-content p {
            margin: 0;
            font-size: 14px;
            opacity: 0.9;
        }

        .view-cart-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.3s;
            margin-top: 5px;
        }

        .view-cart-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        /* Related Products Section */
        .related-products {
            margin: 60px 0 40px;
        }
        
        .section-title {
            font-size: 28px;
            color: #333;
            margin-bottom: 30px;
            text-align: center;
            position: relative;
            padding-bottom: 15px;
        }
        
        .section-title:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 3px;
            background: #b8860b;
        }
        
        /* PERFECT 1:1 RATIO E-COMMERCE PRODUCT CARDS - 4 PER ROW */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            padding: 8px;
        }

        .product-card {
            padding: 4px;
            text-align: left;
            display: flex;
            flex-direction: column;
            height: 100%;
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        /* PERFECT 1:1 RATIO IMAGE BOX */
        .product-img-box {
            width: 100%;
            aspect-ratio: 1 / 1;
            overflow: hidden;
            border-radius: 8px;
            background: #f8f9fa;
            position: relative;
        }

        .product-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .product-img:hover {
            transform: scale(1.05);
        }

        .product-description {
            margin-top: 8px;
            font-size: 13px;
            color: #333;
            line-height: 1.4;
            flex-grow: 1;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .product-rate {
            margin-top: 5px;
            font-size: 15px;
            font-weight: bold;
            color: #b8860b;
        }

        .details-btn {
            display: inline-block;
            margin-top: 6px;
            padding: 6px 12px;
            font-size: 13px;
            background: #b8860b;
            color: white;
            border-radius: 5px;
            text-decoration: none;
            transition: background 0.3s ease;
            text-align: center;
            width: 100%;
        }

        .details-btn:hover {
            background: #a3780a;
        }
        
        /* Features Section */
        .features {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 25px;
            margin: 40px 0;
            padding: 40px 0;
            background-color: #f9f9f9;
        }
        
        .feature {
            text-align: center;
            padding: 25px 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        
        .feature i {
            font-size: 35px;
            color: #b8860b;
            margin-bottom: 15px;
        }
        
        .feature h3 {
            margin-bottom: 12px;
            font-size: 18px;
            color: #333;
        }
        
        .feature p {
            font-size: 14px;
            color: #666;
            line-height: 1.5;
        }
        
        /* Footer */
        footer {
            background-color: #222;
            color: #ddd;
            padding: 40px 0 15px;
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 25px;
            margin-bottom: 25px;
        }
        
        .footer-column h3 {
            color: white;
            margin-bottom: 15px;
            font-size: 16px;
            padding-bottom: 6px;
            border-bottom: 2px solid #b8860b;
            display: inline-block;
        }
        
        .footer-links {
            list-style: none;
        }
        
        .footer-links li {
            margin-bottom: 8px;
        }
        
        .footer-links a {
            color: #ddd;
            text-decoration: none;
            font-size: 13px;
            transition: color 0.3s;
        }
        
        .footer-links a:hover {
            color: #b8860b;
        }
        
        .social-links {
            display: flex;
            gap: 10px;
            margin-top: 12px;
        }
        
        .social-links a {
            color: white;
            background: #444;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s;
            font-size: 13px;
        }
        
        .social-links a:hover {
            background: #b8860b;
        }
        
        .copyright {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid #444;
            font-size: 12px;
            color: #999;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .products-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .product-details-layout {
                grid-template-columns: 1fr;
                gap: 30px;
            }
            
            .image-zoom-result {
                width: 350px;
                height: 350px;
                right: 15px;
            }
            
            .features {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .footer-content {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .patterns-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .quick-buy-options {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            body {
                padding-top: 100px;
            }
            
            body.scrolled-down {
                padding-top: 100px;
            }
            
            .main-content {
                margin-top: 5px;
            }
            
            /* Mobile Layout for Product Details */
            .product-details-layout {
                grid-template-columns: 1fr;
                gap: 25px;
            }
            
            .product-gallery {
                order: 1;
                padding: 15px;
            }
            
            .product-info {
                order: 2;
                padding: 20px;
            }
            
            /* Mobile Image Container */
            .main-image-container {
                aspect-ratio: 1 / 1;
                cursor: pointer;
            }
            
            /* Hide zoom result on mobile */
            .image-zoom-result {
                display: none !important;
            }
            
            .image-zoom-lens {
                display: none !important;
            }
            
            .zoom-controls {
                display: none;
            }
            
            /* Mobile click hint */
            .zoom-hint {
                display: flex;
                font-size: 11px;
                padding: 5px 10px;
            }
            
            .header-content {
                flex-wrap: wrap;
            }
            
            /* Trust Info Section */
            .trust-info {
                position: relative;
                padding: 0 40px;
                height: 35px;
                display: flex;
                align-items: center;
                justify-content: center;
                order: 3;
                flex-basis: 100%;
                margin-top: 8px;
                padding: 0;
            }
            
            /* Mobile Menu Toggle */
            .trust-mobile-toggle {
                display: block;
                position: absolute;
                left: 10px;
                top: 50%;
                transform: translateY(-50%);
                background: none;
                border: none;
                font-size: 20px;
                color: #333;
                cursor: pointer;
                z-index: 10;
                padding: 8px;
            }
            
            .trust-info-content {
                padding: 4px 8px;
                gap: 10px;
                font-size: 11px;
                padding-left: 40px;
            }
            
            .trust-item {
                padding: 4px 8px;
            }
            
            /* Main Header Mobile Layout */
            .header-content {
                flex-wrap: nowrap;
                justify-content: space-between;
                padding: 8px 0;
            }
            
            /* Logo */
            .logo {
                order: 1;
                flex: 1;
                justify-content: flex-start;
            }
            
            .logo h1 {
                font-size: 20px;
            }
            
            /* Search Container */
            .search-container {
                order: 2;
                flex: 2;
                margin: 0 10px;
                max-width: none;
            }
            
            /* User Actions */
            .user-actions {
                order: 3;
                flex: 1;
                justify-content: flex-end;
                gap: 10px;
            }
            
            .user-action {
                font-size: 10px;
            }
            
            .user-action i {
                font-size: 16px;
            }
            
            .features {
                grid-template-columns: 1fr;
                padding: 30px 0;
                margin: 30px 0;
            }
            
            .uses-top-bar {
                display: none;
            }
            
            .profile-name {
                display: none;
            }
            
            .patterns-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .products-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .page-header h1 {
                font-size: 24px;
            }
            
            .product-title {
                font-size: 26px;
            }
            
            .product-price {
                font-size: 28px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            /* Mobile Full Image Overlay */
            .full-image-overlay {
                padding: 10px;
            }
            
            .full-image-container {
                max-width: 100%;
                max-height: 100%;
            }
            
            .full-image-nav {
                width: 40px;
                height: 40px;
                font-size: 20px;
            }
            
            .prev-image {
                left: 10px;
            }
            
            .next-image {
                right: 10px;
            }
            
            .close-full-image {
                top: -50px;
                right: 50%;
                transform: translateX(50%);
            }
            
            .image-counter {
                bottom: -50px;
            }
            
            /* Shop Now System Mobile */
            .cart-summary-sidebar {
                width: 90%;
                right: -100%;
            }
            
            .quick-buy-options {
                grid-template-columns: 1fr;
            }
            
            .shop-now-btn, .buy-now-btn {
                padding: 14px 20px;
                font-size: 16px;
            }
            
            .add-to-cart-notification {
                top: 80px;
                right: 10px;
                left: 10px;
                max-width: none;
            }
            
            .modal-content {
                max-width: 95%;
            }
            
            .rate-controls {
                flex-direction: column;
            }
        }

        @media (max-width: 480px) {
            body {
                padding-top: 100px;
            }
            
            .products-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .footer-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .patterns-grid {
                grid-template-columns: 1fr;
            }
            
            .page-header {
                padding: 8px 0;
                margin-bottom: 3px;
                min-height: 50px;
            }
            
            .page-header h1 {
                font-size: 22px;
            }
            
            .product-title {
                font-size: 24px;
            }
            
            .product-price {
                font-size: 26px;
            }
            
            .product-description-full {
                font-size: 14px;
            }
            
            .specifications h3 {
                font-size: 18px;
            }
            
            .action-buttons .action-btn {
                padding: 12px 20px;
                font-size: 14px;
            }
            
            .trust-mobile-toggle {
                left: 5px;
                padding: 6px;
            }
            
            .trust-info-content {
                padding-left: 35px;
            }
            
            .thumbnail {
                width: 70px;
                height: 70px;
            }
            
            /* Shop Now System Mobile */
            .quick-buy-section {
                padding: 15px;
            }
            
            .cart-summary-sidebar {
                width: 100%;
            }
            
            .summary-actions {
                flex-direction: column;
            }
            
            .modal-actions {
                flex-direction: column;
            }
            
            .unit-option {
                min-width: 100px;
                padding: 10px 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Mobile Menu Overlay -->
    <div class="menu-overlay" id="menuOverlay"></div>
    
    <!-- Mobile Slide-out Menu -->
    <div class="mobile-uses-menu" id="mobileUsesMenu">
        <div class="mobile-menu-header">
            <h3>Stone Categories</h3>
            <button class="close-menu" id="closeMenu">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="mobile-uses-list" id="mobileUsesList">
            <div class="loading-categories">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading categories...</p>
            </div>
        </div>
    </div>

    <!-- ===== SHOP NOW POPUP MODAL ===== -->
    <div class="shop-now-modal" id="shopNowModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-shopping-cart"></i> Complete Your Order</h3>
                <button class="close-modal" id="closeModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="modal-section">
                    <h4><i class="fas fa-info-circle"></i> Order Details</h4>
                    <div id="modalOrderDetails">
                        <!-- Order details will be dynamically inserted here -->
                    </div>
                </div>
                
                <div class="modal-section">
                    <h4><i class="fas fa-user"></i> Your Information</h4>
                    <div class="modal-input-group">
                        <label for="modalName">Full Name *</label>
                        <input type="text" id="modalName" class="modal-input" placeholder="Enter your full name">
                    </div>
                    <div class="modal-input-group">
                        <label for="modalEmail">Email Address *</label>
                        <input type="email" id="modalEmail" class="modal-input" placeholder="Enter your email">
                    </div>
                    <div class="modal-input-group">
                        <label for="modalPhone">Phone Number *</label>
                        <input type="tel" id="modalPhone" class="modal-input" placeholder="Enter your phone number">
                    </div>
                </div>
                
                <div class="modal-section">
                    <h4><i class="fas fa-map-marker-alt"></i> Delivery Address</h4>
                    <div class="modal-input-group">
                        <label for="modalAddress">Address *</label>
                        <textarea id="modalAddress" class="modal-input" rows="3" placeholder="Enter your complete address"></textarea>
                    </div>
                    <div class="modal-input-group">
                        <label for="modalPincode">Pincode *</label>
                        <input type="text" id="modalPincode" class="modal-input" placeholder="Enter pincode">
                    </div>
                </div>
                
                <div class="modal-section">
                    <h4><i class="fas fa-calendar-alt"></i> Delivery Options</h4>
                    <div class="modal-checkbox-group">
                        <input type="checkbox" id="standardDelivery" class="modal-checkbox" checked>
                        <label for="standardDelivery" class="modal-checkbox-label">
                            <strong>Standard Delivery</strong> (5-7 business days) - FREE
                        </label>
                    </div>
                    <div class="modal-checkbox-group">
                        <input type="checkbox" id="expressDelivery" class="modal-checkbox">
                        <label for="expressDelivery" class="modal-checkbox-label">
                            <strong>Express Delivery</strong> (2-3 business days) - 25
                        </label>
                    </div>
                </div>
                
                <div class="order-summary" id="modalOrderSummary">
                    <!-- Order summary will be dynamically calculated -->
                </div>
                
                <div class="modal-actions">
                    <button class="modal-btn modal-cancel" id="modalCancel">
                        <i class="fas fa-times"></i>
                        Cancel
                    </button>
                    <button class="modal-btn modal-confirm" id="modalConfirm">
                        <i class="fas fa-check"></i>
                        Confirm & Place Order
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== CART SUMMARY SIDEBAR ===== -->
    <div class="cart-overlay" id="cartOverlay"></div>

    <div class="cart-summary-sidebar" id="cartSummarySidebar">
        <div class="cart-summary-header">
            <h3><i class="fas fa-shopping-cart"></i> Order Summary</h3>
            <button class="close-summary" id="closeSummary">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="cart-summary-content" id="cartSummaryContent">
            <!-- Cart items will be dynamically added here -->
        </div>
        
        <div class="cart-summary-footer">
            <div class="summary-total">
                <span>Total:</span>
                <span class="summary-total-price" id="summaryTotalPrice">0.00</span>
            </div>
            
            <div class="summary-actions">
                <button class="summary-btn continue-shopping" id="continueShopping">
                    <i class="fas fa-arrow-left"></i>
                    Continue Shopping
                </button>
                <button class="summary-btn checkout-btn" id="proceedToCheckout">
                    <i class="fas fa-lock"></i>
                    Proceed to Checkout
                </button>
            </div>
        </div>
    </div>

    <!-- ===== ADD TO CART NOTIFICATION ===== -->
    <div class="add-to-cart-notification" id="addToCartNotification">
        <div class="notification-icon">
            <i class="fas fa-check-circle"></i>
        </div>
        <div class="notification-content">
            <h4>Added to Cart!</h4>
            <p id="notificationMessage">Item successfully added to your shopping cart.</p>
            <button class="view-cart-btn" id="viewCartFromNotification">View Cart</button>
        </div>
    </div>

    <!-- ===== FULL IMAGE VIEW OVERLAY ===== -->
    <div class="full-image-overlay" id="fullImageOverlay">
        <button class="close-full-image" id="closeFullImage">
            <i class="fas fa-times"></i>
        </button>
        <button class="full-image-nav prev-image" id="prevImageBtn">
            <i class="fas fa-chevron-left"></i>
        </button>
        <div class="full-image-container">
            <img src="" alt="Full size image" class="full-image" id="fullImage">
            <div class="image-counter" id="imageCounter">1 / 3</div>
        </div>
        <button class="full-image-nav next-image" id="nextImageBtn">
            <i class="fas fa-chevron-right"></i>
        </button>
    </div>

    <!-- ===== HEADER ===== -->
    <header id="mainHeader">
        <div class="trust-info">
            <button class="trust-mobile-toggle" id="trustMobileToggle">
                <i class="fas fa-bars"></i>
            </button>
            
            <div class="trust-info-content">
                <div class="trust-item">
                    <i class="fas fa-truck"></i>
                    <span>Free UK Delivery</span>
                </div>
                <div class="trust-item">
                    <i class="fas fa-star"></i>
                    <span>Rated 4.8/5</span>
                </div>
                <div class="trust-item">
                    <i class="fas fa-award"></i>
                    <span>BSF Member</span>
                </div>
            </div>
        </div>

        <!-- Main Header -->
        <div class="main-header">
            <div class="container header-content">
                <div class="logo">
                    <a href="index.html" style="text-decoration: none; color: inherit;">
                        <h1>Stone<span>Craft</span></h1>
                    </a>
                </div>
                
                <!-- Advanced Search -->
                <div class="search-container">
                    <div class="search-input-container">
                        <input type="text" class="search-input" id="searchInput" placeholder="Search for stones, products, categories...">
                        <button class="search-button" id="searchButton">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                    <div class="search-results" id="searchResults">
                        <!-- Search results will be dynamically loaded here -->
                    </div>
                </div>
                
                <div class="user-actions">
                    <!-- Dynamic User Profile -->
                    <div class="user-profile" id="userProfile" style="display: none;">
                        <button class="profile-toggle" id="profileToggle">
                            <div class="profile-avatar" id="profileAvatar">U</div>
                            <span class="profile-name" id="profileName">User</span>
                            <i class="fas fa-chevron-down" style="font-size: 11px;"></i>
                        </button>
                        <div class="profile-dropdown" id="profileDropdown">
                            <div class="dropdown-header">
                                <div class="profile-name" id="dropdownUserName">User Name</div>
                                <div class="user-email" id="dropdownUserEmail">user@example.com</div>
                            </div>
                            <ul class="dropdown-menu">
                                <li><a href="dashboard.html" class="dropdown-item"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                                <li><a href="orders.html" class="dropdown-item"><i class="fas fa-history"></i> Order History</a></li>
                                <li><a href="wishlist.html" class="dropdown-item"><i class="fas fa-heart"></i> My Wishlist</a></li>
                                <li><a href="billing.html" class="dropdown-item"><i class="fas fa-address-card"></i> Billing/Shipping</a></li>
                                <li class="dropdown-divider"></li>
                                <li><a href="#" class="dropdown-item" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- Login Button -->
                    <a href="login.html" class="user-action" id="loginButton">
                        <i class="fas fa-user"></i>
                        <span>Sign In</span>
                    </a>
                    
                    <!-- Cart with Badge -->
                    <a href="cart.html" class="user-action" id="cartButton">
                        <i class="fas fa-shopping-cart"></i>
                        <span>Cart</span>
                        <span class="cart-badge" id="cartBadge">0</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- Banner Text -->
        <div class="banner-text">
            <div class="container">
                Premium Natural Stone Collections - Sandstone, Marble & Limestone for UK Homes & Commercial Projects
            </div>
        </div>
    </header>

    <!-- Desktop Uses Top Bar with Mega Menu -->
    <div class="uses-top-bar">
        <div class="container uses-container" id="dynamicUsesContainer">
            <div class="loading-categories">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading navigation...</p>
            </div>
        </div>
    </div>

    <!-- ===== MAIN CONTENT ===== -->
    <div class="main-content">
        <div class="container">
            <!-- Page Header -->
            <div class="page-header">
                <h1 id="pageTitle">Product Details</h1>
                <div class="breadcrumb" id="breadcrumb">
                    <a href="index.html">Home</a>
                    <span>></span>
                    <a href="category-products.html">Products</a>
                    <span>></span>
                    <span id="productNameBreadcrumb">Product Name</span>
                </div>
            </div>
            
            <!-- Product Details -->
            <div id="productDetailsContainer">
                <div class="loading-products">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Loading product details...</p>
                </div>
            </div>
            
            <!-- Related Products Section -->
            <div class="related-products">
                <h2 class="section-title">Related Products</h2>
                <div id="relatedProductsGrid" class="products-grid">
                    <div class="loading-products">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading related products...</p>
                    </div>
                </div>
            </div>

            <!-- ===== FEATURES SECTION ===== -->
            <section class="features">
                <div class="container">
                    <div class="feature">
                        <i class="fas fa-shipping-fast"></i>
                        <h3>Free UK Delivery</h3>
                        <p>Free delivery on all orders across the United Kingdom with no minimum spend required. Fast and reliable shipping.</p>
                    </div>
                    <div class="feature">
                        <i class="fas fa-award"></i>
                        <h3>Quality Guaranteed</h3>
                        <p>All our stones are sourced from trusted quarries and come with quality certification and warranty.</p>
                    </div>
                    <div class="feature">
                        <i class="fas fa-headset"></i>
                        <h3>Expert Support</h3>
                        <p>Get expert advice from our stone specialists for your project requirements. We're here to help you choose the perfect stone.</p>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- ===== FOOTER ===== -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>StoneCraft</h3>
                    <ul class="footer-links">
                        <li><a href="index.html">Home</a></li>
                        <li><a href="category-products.html">Products</a></li>
                        <li><a href="#">About Us</a></li>
                        <li><a href="#">Our Story</a></li>
                        <li><a href="#">Sustainability</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Products</h3>
                    <ul class="footer-links">
                        <li><a href="category-products.html?usage=flooring">Flooring Stones</a></li>
                        <li><a href="category-products.html?usage=wall">Wall Stones</a></li>
                        <li><a href="category-products.html?usage=bathroom">Bathroom Stones</a></li>
                        <li><a href="category-products.html?usage=outdoor">Outdoor Stones</a></li>
                        <li><a href="category-products.html?usage=kitchen">Kitchen Stones</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Support</h3>
                    <ul class="footer-links">
                        <li><a href="#">Contact Us</a></li>
                        <li><a href="#">Delivery Info</a></li>
                        <li><a href="#">Returns Policy</a></li>
                        <li><a href="#">Installation Guide</a></li>
                        <li><a href="#">FAQ</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Legal</h3>
                    <ul class="footer-links">
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="#">Terms of Service</a></li>
                        <li><a href="#">Cookie Policy</a></li>
                        <li><a href="#">Disclaimer</a></li>
                        <li><a href="#">Sitemap</a></li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2024 StoneCraft UK. All rights reserved. | Registered in England No: 12345678</p>
            </div>
        </div>
    </footer>

    <!-- Smart Scroll Behavior Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const header = document.getElementById('mainHeader');
            const usesTopBar = document.querySelector('.uses-top-bar');
            const body = document.body;
            let lastScrollY = window.scrollY;
            let ticking = false;
            
            function updateScroll() {
                const currentScrollY = window.scrollY;
                
                if (currentScrollY > 50) {
                    header.classList.add('hidden');
                    header.classList.remove('visible');
                    body.classList.add('scrolled-down');
                } else {
                    header.classList.remove('hidden');
                    header.classList.add('visible');
                    body.classList.remove('scrolled-down');
                }
                
                if (usesTopBar) {
                    if (currentScrollY > 120) {
                        usesTopBar.style.top = '0';
                    } else {
                        usesTopBar.style.top = '120px';
                    }
                }
                
                lastScrollY = currentScrollY;
                ticking = false;
            }
            
            function onScroll() {
                if (!ticking) {
                    requestAnimationFrame(updateScroll);
                    ticking = true;
                }
            }
            
            window.addEventListener('scroll', onScroll, { passive: true });
            
            header.classList.add('visible');
            usesTopBar.style.top = '120px';
        });
    </script>

    <!-- COMPLETE JAVASCRIPT WITH ALL MISSING FUNCTIONS -->
    <script type="module">
        import { 
            db, auth, 
            collection, getDocs, doc, getDoc,
            onAuthStateChanged, signOut
        } from './firebase-config.js';

        const appState = {
            currentProduct: null,
            allProducts: [],
            relatedProducts: [],
            user: null,
            cart: [],
            quantity: 1,
            selectedUnit: 'sqft',
            selectedUnitDisplay: 'Square Feet',
            currentImages: [],
            currentImageIndex: 0,
            currentRate: 0,
            selectedLength: 0,
            selectedWidth: 0,
            selectedHeight: 0
        };

        // ========== CORE INITIALIZATION FUNCTIONS ==========
        
        function loadCart() {
            const savedCart = localStorage.getItem('stonecraft_cart');
            if (savedCart) {
                appState.cart = JSON.parse(savedCart);
                updateCartBadge();
            }
        }

        function saveCart() {
            localStorage.setItem('stonecraft_cart', JSON.stringify(appState.cart));
            updateCartBadge();
        }

        function updateCartBadge() {
            const cartBadge = document.getElementById('cartBadge');
            if (cartBadge) {
                const totalItems = appState.cart.reduce((sum, item) => sum + item.quantity, 0);
                cartBadge.textContent = totalItems;
            }
        }

        // ========== MAIN PAGE INITIALIZATION ==========
        
        async function initializePage(productId) {
            try {
                console.log(' Starting page initialization...');
                await loadAllProductsFromFirestore();
                await loadProductDetails(productId);
                generateUsesNavigation();
                console.log(' Page initialization completed successfully!');
            } catch (error) {
                console.error(' Error initializing page:', error);
                showError('Failed to load product details');
                fallbackToSampleData(productId);
            }
        }

        async function loadAllProductsFromFirestore() {
            try {
                console.log(' Loading all products from Firestore...');
                const querySnapshot = await getDocs(collection(db, "products"));
                appState.allProducts = [];
                
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    let processedData = { ...data };
                    
                    if (data.additional_fields && Array.isArray(data.additional_fields)) {
                        data.additional_fields.forEach(field => {
                            if (field && typeof field === 'object') {
                                processedData = { ...processedData, ...field };
                            }
                        });
                    }
                    
                    appState.allProducts.push({
                        id: doc.id,
                        ...processedData
                    });
                });
                
                console.log(' All products loaded from Firestore:', appState.allProducts.length);
                
                if (appState.allProducts.length === 0) {
                    console.log(' No products found in Firestore, using sample data');
                    appState.allProducts = getSampleProducts();
                }
                
            } catch (error) {
                console.error(' Error loading products from Firestore:', error);
                appState.allProducts = getSampleProducts();
            }
        }

        async function loadProductDetails(productId) {
            try {
                console.log(` Loading product details for ID: ${productId}`);
                
                const productRef = doc(db, "products", productId);
                const productSnap = await getDoc(productRef);
                
                if (productSnap.exists()) {
                    const data = productSnap.data();
                    let processedData = { ...data };
                    
                    if (data.additional_fields && Array.isArray(data.additional_fields)) {
                        data.additional_fields.forEach(field => {
                            if (field && typeof field === 'object') {
                                processedData = { ...processedData, ...field };
                            }
                        });
                    }
                    
                    appState.currentProduct = {
                        id: productSnap.id,
                        ...processedData
                    };
                    
                    console.log(' Product loaded from Firestore:', appState.currentProduct.stone_name);
                } else {
                    console.log(' Product not found in Firestore, searching in loaded products...');
                    appState.currentProduct = appState.allProducts.find(p => p.id === productId);
                    
                    if (!appState.currentProduct) {
                        console.log(' Product not found, using first sample product');
                        appState.currentProduct = getSampleProducts()[0];
                    }
                }
                
                displayProductDetails();
                loadRelatedProducts();
                
            } catch (error) {
                console.error(' Error loading product details:', error);
                appState.currentProduct = getSampleProducts().find(p => p.id == productId) || getSampleProducts()[0];
                displayProductDetails();
                loadRelatedProducts();
            }
        }

        function fallbackToSampleData(productId) {
            console.log(' Falling back to sample data...');
            appState.allProducts = getSampleProducts();
            appState.currentProduct = getSampleProducts().find(p => p.id == productId) || getSampleProducts()[0];
            
            if (appState.currentProduct) {
                displayProductDetails();
                loadRelatedProducts();
                generateUsesNavigation();
                console.log(' Fallback data loaded successfully');
            } else {
                showError('Unable to load product details');
            }
        }

        // ========== DISPLAY FUNCTIONS ==========

        function displayProductDetails() {
            const product = appState.currentProduct;
            if (!product) {
                showError('Product not found');
                return;
            }
            
            document.getElementById('pageTitle').textContent = product.stone_name || 'Product Details';
            document.getElementById('productNameBreadcrumb').textContent = product.stone_name || 'Product';
            
            const images = product.images || [];
            if (images.length === 0 && product.image) {
                images.push(product.image);
            }
            if (images.length === 0) {
                images.push(getDefaultImage(product.category));
            }
            
            appState.currentImages = images;
            
            const productHTML = `
                <div class="product-details-layout">
                    <!-- Product Images Gallery -->
                    <div class="product-gallery">
                        <div class="main-image-container" id="zoomContainer">
                            <img src="${images[0]}" alt="${product.stone_name}" class="main-image" id="mainProductImage">
                            <div class="image-zoom-lens" id="zoomLens"></div>
                            <div class="image-zoom-result" id="zoomResult">
                                <img id="zoomedImage" src="${images[0]}" alt="Zoomed view">
                            </div>
                            <div class="zoom-hint">
                                <i class="fas fa-search-plus"></i>
                                <span>Click to view full image</span>
                            </div>
                            <div class="zoom-controls">
                                <button class="zoom-btn" id="zoomInBtn" title="Zoom In">+</button>
                                <button class="zoom-btn" id="zoomOutBtn" title="Zoom Out">-</button>
                                <button class="zoom-btn" id="zoomResetBtn" title="Reset Zoom"></button>
                            </div>
                        </div>
                        
                        ${images.length > 1 ? `
                        <div class="thumbnail-gallery">
                            ${images.map((img, index) => `
                                <img src="${img}" alt="Thumbnail ${index + 1}" class="thumbnail ${index === 0 ? 'active' : ''}" 
                                     data-index="${index}" onclick="changeMainImage(this, ${index})">
                            `).join('')}
                        </div>
                        ` : ''}
                    </div>
                    
                    <!-- Product Information -->
                    <div class="product-info">
                        <h1 class="product-title">${product.stone_name || 'Stone Product'}</h1>
                        <div class="product-category">${product.category || 'Natural Stone'}</div>
                        
                        <div class="product-price">
                            ${product.price || 'Contact for price'}
                            ${product.price_unit ? `<span class="product-price-unit">per ${product.price_unit}</span>` : ''}
                        </div>
                        
                        <div class="product-description-full">
                            ${product.description || 'No description available.'}
                        </div>
                        
                        <!-- ===== SPECIFICATIONS SECTION ===== -->
                        <div class="specifications">
                            <h3>Technical Specifications</h3>
                            <table class="specs-table">
                                ${product.type ? `
                                <tr>
                                    <td class="spec-label">Type</td>
                                    <td class="spec-value">${product.type}</td>
                                </tr>
                                ` : ''}
                                
                                ${product.color ? `
                                <tr>
                                    <td class="spec-label">Color</td>
                                    <td class="spec-value">${product.color}</td>
                                </tr>
                                ` : ''}
                                
                                ${product.size ? `
                                <tr>
                                    <td class="spec-label">Size</td>
                                    <td class="spec-value">${product.size}</td>
                                </tr>
                                ` : ''}
                                
                                ${product.length && product.width ? `
                                <tr>
                                    <td class="spec-label">Dimensions</td>
                                    <td class="spec-value">${product.length}  ${product.width} ${product.thickness ? ' ' + product.thickness : ''}</td>
                                </tr>
                                ` : ''}
                                
                                ${product.thickness ? `
                                <tr>
                                    <td class="spec-label">Thickness</td>
                                    <td class="spec-value">${product.thickness}</td>
                                </tr>
                                ` : ''}
                                
                                ${product.finish ? `
                                <tr>
                                    <td class="spec-label">Finish</td>
                                    <td class="spec-value">${product.finish}</td>
                                </tr>
                                ` : ''}
                                
                                ${product.density ? `
                                <tr>
                                    <td class="spec-label">Density</td>
                                    <td class="spec-value">${product.density}</td>
                                </tr>
                                ` : ''}
                                
                                ${product.water_absorption ? `
                                <tr>
                                    <td class="spec-label">Water Absorption</td>
                                    <td class="spec-value">${product.water_absorption}</td>
                                </tr>
                                ` : ''}
                                
                                ${product.compressive_strength ? `
                                <tr>
                                    <td class="spec-label">Compressive Strength</td>
                                    <td class="spec-value">${product.compressive_strength}</td>
                                </tr>
                                ` : ''}
                                
                                ${product.uses ? `
                                <tr>
                                    <td class="spec-label">Best For</td>
                                    <td class="spec-value">${product.uses}</td>
                                </tr>
                                ` : ''}
                            </table>
                        </div>
                        
                        <!-- ===== RATE SETUP SECTION ===== -->
                        <div class="rate-setup-section">
                            <h3 class="rate-setup-title">
                                <i class="fas fa-calculator"></i>
                                Calculate Your Rate
                            </h3>
                            
                            <div class="rate-controls">
                                <div class="rate-control-group">
                                    <label for="lengthInput">Length</label>
                                    <div class="rate-input-group">
                                        <input type="number" id="lengthInput" class="rate-input" min="0" step="0.1" placeholder="Enter length">
                                        <div class="rate-unit">Feet</div>
                                    </div>
                                </div>
                                
                                <div class="rate-control-group">
                                    <label for="widthInput">Width</label>
                                    <div class="rate-input-group">
                                        <input type="number" id="widthInput" class="rate-input" min="0" step="0.1" placeholder="Enter width">
                                        <div class="rate-unit">Feet</div>
                                    </div>
                                </div>
                                
                                <div class="rate-control-group">
                                    <label for="heightInput">Height/Thickness</label>
                                    <div class="rate-input-group">
                                        <input type="number" id="heightInput" class="rate-input" min="0" step="0.1" placeholder="Enter height">
                                        <div class="rate-unit">mm</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Unit Selector -->
                            <div class="unit-selector">
                                <div class="unit-option selected" data-unit="sqft" data-display="Square Feet">
                                    <i class="fas fa-square"></i>
                                    Square Feet
                                </div>
                                <div class="unit-option" data-unit="sqm" data-display="Square Meters">
                                    <i class="fas fa-ruler-combined"></i>
                                    Square Meters
                                </div>
                                <div class="unit-option" data-unit="piece" data-display="Pieces">
                                    <i class="fas fa-cube"></i>
                                    Pieces
                                </div>
                                <div class="unit-option" data-unit="cft" data-display="Cubic Feet">
                                    <i class="fas fa-box"></i>
                                    Cubic Feet
                                </div>
                            </div>
                            
                            <!-- Quantity Selector -->
                            <div class="quantity-selector">
                                <div class="quantity-label">Quantity:</div>
                                <div class="quantity-controls">
                                    <button class="quantity-btn" id="decreaseQuantity">-</button>
                                    <input type="number" class="quantity-input" id="quantityInput" value="1" min="1">
                                    <button class="quantity-btn" id="increaseQuantity">+</button>
                                </div>
                            </div>
                            
                            <!-- Rate Display -->
                            <div style="text-align: center; margin: 25px 0;">
                                <div style="font-size: 14px; color: #666; margin-bottom: 8px;">Total Rate:</div>
                                <div style="font-size: 36px; font-weight: 700; color: #b8860b;" id="totalRateDisplay">0.00</div>
                                <button class="action-btn primary-btn" id="calculateBtn" style="margin-top: 15px;">
                                    <i class="fas fa-calculator"></i>
                                    Calculate Rate
                                </button>
                            </div>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="action-buttons">
                            <button class="action-btn primary-btn" id="addToCartBtn">
                                <i class="fas fa-cart-plus"></i>
                                Add to Cart
                            </button>
                            <a href="category-products.html?usage=${product.uses ? product.uses.toLowerCase().replace(/\s+/g, '-') : ''}" class="action-btn secondary-btn">
                                <i class="fas fa-th-large"></i>
                                View Similar Products
                            </a>
                        </div>
                        
                        <!-- ===== SHOP NOW SYSTEM ===== -->
                        <div class="quick-buy-section">
                            <h3 class="quick-buy-title">
                                <i class="fas fa-bolt"></i>
                                Quick Buy Options
                            </h3>
                            
                            <div class="quick-buy-options" id="quickBuyOptions">
                                <div class="quick-buy-option selected" data-quantity="10" data-unit="sqft">
                                    <div class="option-amount">10</div>
                                    <div class="option-unit">Square Feet</div>
                                    <div class="option-price"> <span id="price10">${product.price ? (product.price * 10).toFixed(2) : '0.00'}</span></div>
                                    <div class="option-savings">Best Value</div>
                                </div>
                                
                                <div class="quick-buy-option" data-quantity="25" data-unit="sqft">
                                    <div class="option-amount">25</div>
                                    <div class="option-unit">Square Feet</div>
                                    <div class="option-price"> <span id="price25">${product.price ? (product.price * 25 * 0.95).toFixed(2) : '0.00'}</span></div>
                                    <div class="option-savings">Save 5%</div>
                                </div>
                                
                                <div class="quick-buy-option" data-quantity="50" data-unit="sqft">
                                    <div class="option-amount">50</div>
                                    <div class="option-unit">Square Feet</div>
                                    <div class="option-price"> <span id="price50">${product.price ? (product.price * 50 * 0.90).toFixed(2) : '0.00'}</span></div>
                                    <div class="option-savings">Save 10%</div>
                                </div>
                            </div>
                            
                            <!-- Shop Now Button -->
                            <button class="shop-now-btn" id="shopNowBtn">
                                <i class="fas fa-shopping-cart"></i>
                                <span>SHOP NOW</span>
                            </button>
                            
                            <!-- Direct Buy Now Button -->
                            <button class="buy-now-btn" id="buyNowBtn">
                                <i class="fas fa-bolt"></i>
                                <span>BUY NOW & CHECKOUT</span>
                            </button>
                        </div>
                        
                        <!-- Contact Information -->
                        ${product.factory_name || product.contact_number || product.email ? `
                        <div class="contact-info">
                            <h3>Contact Supplier</h3>
                            <div class="contact-details">
                                ${product.factory_name ? `
                                <div class="contact-item">
                                    <i class="fas fa-industry"></i>
                                    <span>${product.factory_name}</span>
                                </div>
                                ` : ''}
                                
                                ${product.contact_number ? `
                                <div class="contact-item">
                                    <i class="fas fa-phone"></i>
                                    <span>${product.contact_number}</span>
                                </div>
                                ` : ''}
                                
                                ${product.email ? `
                                <div class="contact-item">
                                    <i class="fas fa-envelope"></i>
                                    <span>${product.email}</span>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                        ` : ''}
                    </div>
                </div>
            `;
            
            document.getElementById('productDetailsContainer').innerHTML = productHTML;
            
            // Initialize UI components
            setTimeout(() => {
                initializeEnhancedSmartZoom();
                initializeEventListeners();
                initializeShopNowSystem();
                calculateRate();
            }, 100);
        }

        // ========== EVENT LISTENERS ==========

        function initializeEventListeners() {
            // Quantity controls
            const increaseBtn = document.getElementById('increaseQuantity');
            const decreaseBtn = document.getElementById('decreaseQuantity');
            const quantityInput = document.getElementById('quantityInput');
            
            if (increaseBtn) {
                increaseBtn.addEventListener('click', function() {
                    if (quantityInput) {
                        quantityInput.value = parseInt(quantityInput.value) + 1;
                        appState.quantity = parseInt(quantityInput.value);
                        calculateRate();
                    }
                });
            }
            
            if (decreaseBtn) {
                decreaseBtn.addEventListener('click', function() {
                    if (quantityInput && quantityInput.value > 1) {
                        quantityInput.value = parseInt(quantityInput.value) - 1;
                        appState.quantity = parseInt(quantityInput.value);
                        calculateRate();
                    }
                });
            }
            
            if (quantityInput) {
                quantityInput.addEventListener('change', function() {
                    if (this.value < 1) this.value = 1;
                    appState.quantity = parseInt(this.value);
                    calculateRate();
                });
            }
            
            // Unit selector
            const unitOptions = document.querySelectorAll('.unit-option');
            unitOptions.forEach(option => {
                option.addEventListener('click', function() {
                    unitOptions.forEach(o => o.classList.remove('selected'));
                    this.classList.add('selected');
                    appState.selectedUnit = this.getAttribute('data-unit');
                    appState.selectedUnitDisplay = this.getAttribute('data-display') || this.textContent.trim();
                    calculateRate();
                });
            });
            
            // Add to cart button
            const addToCartBtn = document.getElementById('addToCartBtn');
            if (addToCartBtn) {
                addToCartBtn.addEventListener('click', addProductToCartDirect);
            }
            
            // Calculate button
            const calculateBtn = document.getElementById('calculateBtn');
            if (calculateBtn) {
                calculateBtn.addEventListener('click', calculateRate);
            }
            
            // Input listeners for rate calculation
            const lengthInput = document.getElementById('lengthInput');
            const widthInput = document.getElementById('widthInput');
            const heightInput = document.getElementById('heightInput');
            
            if (lengthInput) {
                lengthInput.addEventListener('input', function() {
                    appState.selectedLength = parseFloat(this.value) || 0;
                    calculateRate();
                });
                
                // Set default value
                if (appState.currentProduct && appState.currentProduct.length) {
                    lengthInput.value = appState.currentProduct.length;
                    appState.selectedLength = parseFloat(appState.currentProduct.length) || 0;
                }
            }
            
            if (widthInput) {
                widthInput.addEventListener('input', function() {
                    appState.selectedWidth = parseFloat(this.value) || 0;
                    calculateRate();
                });
                
                if (appState.currentProduct && appState.currentProduct.width) {
                    widthInput.value = appState.currentProduct.width;
                    appState.selectedWidth = parseFloat(appState.currentProduct.width) || 0;
                }
            }
            
            if (heightInput) {
                heightInput.addEventListener('input', function() {
                    appState.selectedHeight = parseFloat(this.value) || 0;
                    calculateRate();
                });
                
                if (appState.currentProduct && appState.currentProduct.thickness) {
                    const thickness = appState.currentProduct.thickness.split('-')[0].trim();
                    heightInput.value = thickness;
                    appState.selectedHeight = parseFloat(thickness) || 0;
                }
            }
        }

        // ========== RATE CALCULATION ==========

        function calculateRate() {
            const totalRateDisplay = document.getElementById('totalRateDisplay');
            if (!totalRateDisplay || !appState.currentProduct) return;
            
            const product = appState.currentProduct;
            const basePrice = parseFloat(product.price) || 0;
            
            let calculatedRate = 0;
            
            if (appState.selectedUnit === 'sqft') {
                const area = (appState.selectedLength * appState.selectedWidth) || 1;
                calculatedRate = basePrice * area * appState.quantity;
            } else if (appState.selectedUnit === 'sqm') {
                const area = (appState.selectedLength * appState.selectedWidth) || 1;
                calculatedRate = (basePrice * 10.764) * area * appState.quantity;
            } else if (appState.selectedUnit === 'piece') {
                calculatedRate = basePrice * appState.quantity;
            } else if (appState.selectedUnit === 'cft') {
                const volume = (appState.selectedLength * appState.selectedWidth * (appState.selectedHeight || 1)) || 1;
                calculatedRate = (basePrice * 0.5) * volume * appState.quantity;
            }
            
            // Apply bulk discounts
            if (appState.quantity >= 50) {
                calculatedRate = calculatedRate * 0.90;
            } else if (appState.quantity >= 25) {
                calculatedRate = calculatedRate * 0.95;
            }
            
            appState.currentRate = calculatedRate;
            totalRateDisplay.textContent = `${calculatedRate.toFixed(2)}`;
            
            // Update quick buy prices
            calculateQuickBuyPrices();
        }

        function calculateQuickBuyPrices() {
            const product = appState.currentProduct;
            if (!product || !product.price) return;
            
            const basePrice = parseFloat(product.price);
            const prices = {
                10: basePrice * 10,
                25: basePrice * 25 * 0.95,
                50: basePrice * 50 * 0.90
            };
            
            Object.keys(prices).forEach(quantity => {
                const priceElement = document.getElementById(`price${quantity}`);
                if (priceElement) {
                    priceElement.textContent = prices[quantity].toFixed(2);
                }
            });
        }

        // ========== SHOP NOW SYSTEM ==========

        function initializeShopNowSystem() {
            console.log(' Initializing Shop Now System...');
            
            // Quick buy options
            const quickBuyOptions = document.querySelectorAll('.quick-buy-option');
            quickBuyOptions.forEach(option => {
                option.addEventListener('click', function() {
                    quickBuyOptions.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    
                    const quantity = this.getAttribute('data-quantity');
                    const unit = this.getAttribute('data-unit');
                    
                    const quantityInput = document.getElementById('quantityInput');
                    if (quantityInput) {
                        quantityInput.value = quantity;
                        appState.quantity = parseInt(quantity);
                    }
                    
                    // Update unit selection
                    document.querySelectorAll('.unit-option').forEach(unitOption => {
                        if (unitOption.getAttribute('data-unit') === unit) {
                            unitOption.click();
                        }
                    });
                    
                    calculateRate();
                });
            });
            
            // Shop Now button
            const shopNowBtn = document.getElementById('shopNowBtn');
            if (shopNowBtn) {
                shopNowBtn.addEventListener('click', openShopNowModal);
            }
            
            // Buy Now button
            const buyNowBtn = document.getElementById('buyNowBtn');
            if (buyNowBtn) {
                buyNowBtn.addEventListener('click', openShopNowModal);
            }
            
            // Modal controls
            const closeModal = document.getElementById('closeModal');
            const modalCancel = document.getElementById('modalCancel');
            const modalConfirm = document.getElementById('modalConfirm');
            const shopNowModal = document.getElementById('shopNowModal');
            
            if (closeModal) {
                closeModal.addEventListener('click', closeShopNowModal);
            }
            
            if (modalCancel) {
                modalCancel.addEventListener('click', closeShopNowModal);
            }
            
            if (modalConfirm) {
                modalConfirm.addEventListener('click', processOrderConfirmation);
            }
            
            if (shopNowModal) {
                shopNowModal.addEventListener('click', function(e) {
                    if (e.target === shopNowModal) {
                        closeShopNowModal();
                    }
                });
            }
            
            // Cart summary
            const closeSummary = document.getElementById('closeSummary');
            const cartOverlay = document.getElementById('cartOverlay');
            const continueShopping = document.getElementById('continueShopping');
            const proceedToCheckout = document.getElementById('proceedToCheckout');
            const viewCartFromNotification = document.getElementById('viewCartFromNotification');
            
            if (closeSummary) closeSummary.addEventListener('click', closeCartSummary);
            if (cartOverlay) cartOverlay.addEventListener('click', closeCartSummary);
            if (continueShopping) continueShopping.addEventListener('click', closeCartSummary);
            
            if (proceedToCheckout) {
                proceedToCheckout.addEventListener('click', function() {
                    saveCart();
                    window.location.href = 'checkout.html';
                });
            }
            
            if (viewCartFromNotification) {
                viewCartFromNotification.addEventListener('click', showCartSummary);
            }
            
            console.log(' Shop Now System initialized');
        }

        function openShopNowModal() {
            const product = appState.currentProduct;
            if (!product) return;
            
            const shopNowModal = document.getElementById('shopNowModal');
            const modalOrderDetails = document.getElementById('modalOrderDetails');
            const modalOrderSummary = document.getElementById('modalOrderSummary');
            
            if (!shopNowModal || !modalOrderDetails || !modalOrderSummary) return;
            
            const expressDelivery = document.getElementById('expressDelivery')?.checked || false;
            const deliveryCost = expressDelivery ? 25 : 0;
            const totalCost = appState.currentRate + deliveryCost;
            
            modalOrderDetails.innerHTML = `
                <div class="summary-row">
                    <span class="summary-label">Product:</span>
                    <span class="summary-value">${product.stone_name}</span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">Quantity:</span>
                    <span class="summary-value">${appState.quantity} ${appState.selectedUnitDisplay}</span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">Dimensions:</span>
                    <span class="summary-value">${appState.selectedLength}  ${appState.selectedWidth} ${appState.selectedHeight ? ' ' + appState.selectedHeight + ' (H)' : ''}</span>
                </div>
            `;
            
            modalOrderSummary.innerHTML = `
                <div class="summary-row">
                    <span class="summary-label">Product Total:</span>
                    <span class="summary-value">${appState.currentRate.toFixed(2)}</span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">Delivery:</span>
                    <span class="summary-value">${deliveryCost === 0 ? 'FREE' : '' + deliveryCost.toFixed(2)}</span>
                </div>
                <div class="summary-row total">
                    <span class="summary-label">Total Amount:</span>
                    <span class="summary-value total-price">${totalCost.toFixed(2)}</span>
                </div>
            `;
            
            // Pre-fill user info
            if (appState.user) {
                const modalName = document.getElementById('modalName');
                const modalEmail = document.getElementById('modalEmail');
                if (modalName) modalName.value = appState.user.name || '';
                if (modalEmail) modalEmail.value = appState.user.email || '';
            }
            
            shopNowModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeShopNowModal() {
            const shopNowModal = document.getElementById('shopNowModal');
            if (shopNowModal) {
                shopNowModal.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        }

        function processOrderConfirmation() {
            const name = document.getElementById('modalName')?.value.trim();
            const email = document.getElementById('modalEmail')?.value.trim();
            const phone = document.getElementById('modalPhone')?.value.trim();
            const address = document.getElementById('modalAddress')?.value.trim();
            const pincode = document.getElementById('modalPincode')?.value.trim();
            
            if (!name || !email || !phone || !address || !pincode) {
                showNotification('Please fill all required fields', 'error');
                return;
            }
            
            if (!validateEmail(email)) {
                showNotification('Please enter a valid email address', 'error');
                return;
            }
            
            const order = {
                id: 'ORD-' + Date.now(),
                productId: appState.currentProduct.id,
                productName: appState.currentProduct.stone_name,
                quantity: appState.quantity,
                unit: appState.selectedUnit,
                unitDisplay: appState.selectedUnitDisplay,
                length: appState.selectedLength,
                width: appState.selectedWidth,
                height: appState.selectedHeight,
                rate: appState.currentRate,
                customerName: name,
                customerEmail: email,
                customerPhone: phone,
                deliveryAddress: address,
                pincode: pincode,
                expressDelivery: document.getElementById('expressDelivery')?.checked || false,
                deliveryCost: document.getElementById('expressDelivery')?.checked ? 25 : 0,
                totalAmount: appState.currentRate + (document.getElementById('expressDelivery')?.checked ? 25 : 0),
                orderDate: new Date().toISOString(),
                status: 'pending'
            };
            
            // Save order
            let orders = JSON.parse(localStorage.getItem('stonecraft_orders') || '[]');
            orders.push(order);
            localStorage.setItem('stonecraft_orders', JSON.stringify(orders));
            
            // Add to cart
            addProductToCartFromOrder(order);
            
            // Close modal and show success
            closeShopNowModal();
            showNotification(`Order placed successfully! Order ID: ${order.id}`, 'success');
            
            // Redirect after delay
            setTimeout(() => {
                window.location.href = 'order-confirmation.html?id=' + order.id;
            }, 2000);
        }

        function addProductToCartFromOrder(order) {
            const existingItem = appState.cart.find(item => 
                item.id === order.productId && 
                item.unit === order.unit &&
                item.length === order.length &&
                item.width === order.width
            );
            
            if (existingItem) {
                existingItem.quantity += order.quantity;
                existingItem.totalPrice = existingItem.price * existingItem.quantity;
            } else {
                appState.cart.push({
                    id: order.productId,
                    name: order.productName,
                    price: order.rate / order.quantity,
                    unit: order.unit,
                    unitDisplay: order.unitDisplay,
                    quantity: order.quantity,
                    length: order.length,
                    width: order.width,
                    height: order.height,
                    totalPrice: order.rate,
                    image: appState.currentProduct.images?.[0] || getDefaultImage(appState.currentProduct.category),
                    category: appState.currentProduct.category,
                    orderId: order.id
                });
            }
            
            saveCart();
        }

        function addProductToCartDirect() {
            const product = appState.currentProduct;
            if (!product) return;
            
            const existingItem = appState.cart.find(item => 
                item.id === product.id && 
                item.unit === appState.selectedUnit &&
                item.length === appState.selectedLength &&
                item.width === appState.selectedWidth
            );
            
            if (existingItem) {
                existingItem.quantity += appState.quantity;
                existingItem.totalPrice = existingItem.price * existingItem.quantity;
            } else {
                appState.cart.push({
                    id: product.id,
                    name: product.stone_name,
                    price: appState.currentRate / appState.quantity,
                    unit: appState.selectedUnit,
                    unitDisplay: appState.selectedUnitDisplay,
                    quantity: appState.quantity,
                    length: appState.selectedLength,
                    width: appState.selectedWidth,
                    height: appState.selectedHeight,
                    totalPrice: appState.currentRate,
                    image: product.images?.[0] || getDefaultImage(product.category),
                    category: product.category
                });
            }
            
            saveCart();
            showAddToCartNotification(product.stone_name, appState.quantity, appState.selectedUnitDisplay);
        }

        // ========== UTILITY FUNCTIONS ==========

        function showAddToCartNotification(productName, quantity, unit) {
            const notification = document.getElementById('addToCartNotification');
            const messageElement = document.getElementById('notificationMessage');
            
            if (!notification || !messageElement) return;
            
            messageElement.textContent = `${quantity} ${unit} of ${productName} added to your cart!`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
            
            const viewCartBtn = document.getElementById('viewCartFromNotification');
            if (viewCartBtn) {
                viewCartBtn.onclick = showCartSummary;
            }
        }

        function showCartSummary() {
            updateCartSummary();
            document.getElementById('cartSummarySidebar').classList.add('active');
            document.getElementById('cartOverlay').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeCartSummary() {
            document.getElementById('cartSummarySidebar').classList.remove('active');
            document.getElementById('cartOverlay').classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        function updateCartSummary() {
            const cartSummaryContent = document.getElementById('cartSummaryContent');
            const summaryTotalPrice = document.getElementById('summaryTotalPrice');
            
            if (!cartSummaryContent) return;
            
            if (appState.cart.length === 0) {
                cartSummaryContent.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px;">
                        <i class="fas fa-shopping-cart" style="font-size: 48px; color: #ddd; margin-bottom: 15px;"></i>
                        <h4 style="color: #666; margin-bottom: 10px;">Your cart is empty</h4>
                        <p style="color: #888; font-size: 14px;">Add some products to get started!</p>
                    </div>
                `;
                if (summaryTotalPrice) summaryTotalPrice.textContent = '0.00';
                return;
            }
            
            const total = appState.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            if (summaryTotalPrice) summaryTotalPrice.textContent = `${total.toFixed(2)}`;
            
            let cartItemsHTML = '';
            appState.cart.forEach((item, index) => {
                cartItemsHTML += `
                    <div class="cart-item-summary">
                        <div class="cart-item-image" style="background-image: url('${item.image}')"></div>
                        <div class="cart-item-details">
                            <div class="cart-item-name">${item.name}</div>
                            <div class="cart-item-meta">
                                ${item.quantity} ${item.unitDisplay}  ${item.price.toFixed(2)} = ${(item.price * item.quantity).toFixed(2)}
                                ${item.length ? `<br>Size: ${item.length}  ${item.width} ${item.height ? ' ' + item.height : ''}` : ''}
                            </div>
                            <div style="display: flex; gap: 10px; margin-top: 8px;">
                                <button class="quantity-btn-sm" onclick="updateCartItemQuantity(${index}, -1)" style="width: 25px; height: 25px; font-size: 12px;">-</button>
                                <span style="font-size: 14px;">${item.quantity}</span>
                                <button class="quantity-btn-sm" onclick="updateCartItemQuantity(${index}, 1)" style="width: 25px; height: 25px; font-size: 12px;">+</button>
                                <button class="remove-item-btn" onclick="removeCartItem(${index})" style="margin-left: auto; background: none; border: none; color: #ff4444; cursor: pointer; font-size: 12px;">
                                    <i class="fas fa-trash"></i> Remove
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            cartSummaryContent.innerHTML = cartItemsHTML;
        }

        // Make cart functions globally available
        window.updateCartItemQuantity = function(index, change) {
            if (appState.cart[index]) {
                const newQuantity = appState.cart[index].quantity + change;
                if (newQuantity < 1) {
                    removeCartItem(index);
                } else {
                    appState.cart[index].quantity = newQuantity;
                    appState.cart[index].totalPrice = appState.cart[index].price * newQuantity;
                    saveCart();
                    updateCartSummary();
                    updateCartBadge();
                }
            }
        };

        window.removeCartItem = function(index) {
            if (appState.cart[index]) {
                appState.cart.splice(index, 1);
                saveCart();
                updateCartSummary();
                updateCartBadge();
                showNotification('Item removed from cart', 'info');
            }
        };

        function changeMainImage(thumbnail, index) {
            const mainImage = document.getElementById('mainProductImage');
            const zoomedImage = document.getElementById('zoomedImage');
            
            if (mainImage && thumbnail.src) {
                mainImage.src = thumbnail.src;
                if (zoomedImage) zoomedImage.src = thumbnail.src;
                
                document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
                thumbnail.classList.add('active');
                appState.currentImageIndex = index;
            }
        }
        window.changeMainImage = changeMainImage;

        // ========== RELATED PRODUCTS ==========

        function loadRelatedProducts() {
            const product = appState.currentProduct;
            if (!product) return;
            
            appState.relatedProducts = appState.allProducts.filter(p => {
                if (p.id === product.id) return false;
                if (p.category === product.category) return true;
                if (p.uses === product.uses) return true;
                return false;
            }).slice(0, 8);
            
            displayRelatedProducts();
        }

        function displayRelatedProducts() {
            const container = document.getElementById('relatedProductsGrid');
            if (!container) return;
            
            if (appState.relatedProducts.length === 0) {
                container.innerHTML = `
                    <div class="no-products" style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                        <i class="fas fa-info-circle" style="font-size: 48px; color: #ddd; margin-bottom: 15px;"></i>
                        <p style="color: #666;">No related products found</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            appState.relatedProducts.forEach(product => {
                const images = product.images || [];
                const imageUrl = images[0] || product.image || getDefaultImage(product.category);
                const description = product.description || "No description";
                const rate = product.price || "N/A";
                const detailsLink = `product-details.html?id=${product.id}`;

                const cardHTML = `
                    <div class="product-card">
                        <a href="${detailsLink}">
                            <div class="product-img-box">
                                <img src="${imageUrl}" alt="${product.stone_name || 'Stone Product'}" class="product-img">
                            </div>
                        </a>
                        <h3 style="margin-top: 8px; font-size: 15px; color: #333; font-weight: 600;">
                            ${product.stone_name || 'Stone Product'}
                        </h3>
                        <p class="product-description">${description.length > 100 ? description.substring(0, 100) + '...' : description}</p>
                        <p class="product-rate"> ${rate}</p>
                        <a href="${detailsLink}" class="details-btn">View Details</a>
                    </div>
                `;

                container.innerHTML += cardHTML;
            });
        }

        // ========== USES NAVIGATION ==========

        function generateUsesNavigation() {
            const desktopContainer = document.getElementById('dynamicUsesContainer');
            const mobileContainer = document.getElementById('mobileUsesList');
            
            if ((!desktopContainer && !mobileContainer) || appState.allProducts.length === 0) return;
            
            const uniqueUses = [...new Set(appState.allProducts
                .filter(product => product.uses && product.uses.trim() !== '')
                .map(product => product.uses.trim())
            )].sort();
            
            if (uniqueUses.length === 0) {
                if (desktopContainer) {
                    desktopContainer.innerHTML = `
                        <div class="loading-categories">
                            <i class="fas fa-info-circle"></i>
                            <p>No categories found</p>
                        </div>
                    `;
                }
                if (mobileContainer) {
                    mobileContainer.innerHTML = `
                        <div class="loading-categories">
                            <i class="fas fa-info-circle"></i>
                            <p>No categories found</p>
                        </div>
                    `;
                }
                return;
            }
            
            // Desktop navigation
            if (desktopContainer) {
                desktopContainer.innerHTML = '';
                uniqueUses.forEach(usage => {
                    const usageKey = usage.toLowerCase().replace(/\s+/g, '-');
                    const useItem = document.createElement('div');
                    useItem.className = 'use-item';
                    useItem.innerHTML = `
                        <a href="category-products.html?usage=${usageKey}" class="use-link">${usage}</a>
                    `;
                    desktopContainer.appendChild(useItem);
                });
            }
            
            // Mobile navigation
            if (mobileContainer) {
                mobileContainer.innerHTML = '';
                uniqueUses.forEach(usage => {
                    const usageKey = usage.toLowerCase().replace(/\s+/g, '-');
                    const mobileUseItem = document.createElement('div');
                    mobileUseItem.className = 'mobile-use-item';
                    mobileUseItem.innerHTML = `
                        <a href="category-products.html?usage=${usageKey}" class="mobile-use-link" onclick="closeMobileMenu()">
                            ${usage}
                        </a>
                    `;
                    mobileContainer.appendChild(mobileUseItem);
                });
            }
        }

        // ========== HELPER FUNCTIONS ==========

        function getDefaultImage(category) {
            const defaultImages = {
                'marble': 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=400&q=80',
                'granite': 'https://images.unsplash.com/photo-1595428774223-ef52624120d2?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=400&q=80',
                'limestone': 'https://images.unsplash.com/photo-1611273426858-450d8e3c9fce?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=400&q=80',
                'sandstone': 'https://images.unsplash.com/photo-1541140532154-b024d705b90a?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=400&q=80',
                'red sand stone': 'https://i.ibb.co/HLpBc94R/51b7aaab131a.jpg'
            };
            
            const cat = category ? category.toLowerCase() : 'marble';
            return defaultImages[cat] || defaultImages.marble;
        }

        function getSampleProducts() {
            return [
                {
                    id: "He7DP5K7CNkYmAK8HqsN",
                    stone_name: "RED SAND STONE",
                    category: "Red Sand Stone",
                    type: "Natural",
                    color: "Red",
                    size: "10",
                    length: "5",
                    width: "2",
                    thickness: "20-30 mm",
                    uses: "Flooring",
                    price: 100,
                    price_unit: "sqft",
                    description: "Premium red sandstone with excellent durability and natural beauty. Perfect for flooring applications in both residential and commercial projects. The natural red hue adds warmth and character to any space.",
                    density: "2.4 g/cm",
                    finish: "Natural",
                    water_absorption: "Low",
                    rate_description: "Competitive pricing with bulk discounts available",
                    factory_name: "ravi jain",
                    contact_number: "+91 7737740207",
                    email: "ravijain236129@gmail.com",
                    compressive_strength: "High",
                    images: [
                        "https://i.ibb.co/HLpBc94R/51b7aaab131a.jpg",
                        "https://images.unsplash.com/photo-1541140532154-b024d705b90a?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
                        "https://images.unsplash.com/photo-1601553598910-aab9e5a5e658?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80"
                    ]
                },
                {
                    id: "2",
                    stone_name: "WHITE MARBLE",
                    category: "Marble",
                    type: "Natural",
                    color: "White",
                    size: "12",
                    length: "6",
                    width: "3",
                    thickness: "25-35 mm",
                    uses: "Flooring",
                    price: 150,
                    price_unit: "sqft",
                    description: "Elegant white marble with fine veining for luxurious interiors. This premium marble is ideal for flooring, wall cladding, and countertops in high-end residential and commercial spaces.",
                    density: "2.7 g/cm",
                    finish: "Polished",
                    water_absorption: "Medium",
                    rate_description: "Premium quality marble at competitive prices",
                    factory_name: "marble works",
                    contact_number: "+91 9876543210",
                    email: "info@marbleworks.com",
                    compressive_strength: "Medium",
                    images: [
                        "https://images.unsplash.com/photo-1586023492125-27b2c045efd7?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
                        "https://images.unsplash.com/photo-1568515042948-bf1c8e79f4cb?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80"
                    ]
                },
                {
                    id: "3",
                    stone_name: "BLACK GRANITE",
                    category: "Granite",
                    type: "Natural",
                    color: "Black",
                    size: "15",
                    length: "7",
                    width: "4",
                    thickness: "30-40 mm",
                    uses: "Countertop",
                    price: 200,
                    price_unit: "sqft",
                    description: "Durable black granite perfect for kitchen countertops. This high-density granite offers excellent resistance to scratches, heat, and stains, making it ideal for heavy-use areas.",
                    density: "2.8 g/cm",
                    finish: "Polished",
                    water_absorption: "Very Low",
                    rate_description: "High-end granite with excellent durability",
                    factory_name: "granite experts",
                    contact_number: "+91 8765432109",
                    email: "sales@graniteexperts.com",
                    compressive_strength: "Very High",
                    images: [
                        "https://images.unsplash.com/photo-1595428774223-ef52624120d2?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
                        "https://images.unsplash.com/photo-1552324190-f087066e1e48?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80"
                    ]
                }
            ];
        }

        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        function showNotification(message, type) {
            const existingNotification = document.querySelector('.notification');
            if (existingNotification) existingNotification.remove();
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div style="position: fixed; top: 100px; right: 20px; background: ${type === 'success' ? '#4CAF50' : '#f44336'}; color: white; padding: 15px 20px; border-radius: 5px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); z-index: 2000; display: flex; align-items: center; gap: 10px;">
                    <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }

        function showError(message) {
            const container = document.getElementById('productDetailsContainer');
            if (container) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 50px 20px;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 48px; color: #ff9900; margin-bottom: 20px;"></i>
                        <h3 style="color: #333; margin-bottom: 15px;">${message}</h3>
                        <p style="color: #666; margin-bottom: 20px;">Please try refreshing the page or contact support.</p>
                        <a href="category-products.html" class="details-btn" style="display: inline-block; width: auto; padding: 10px 20px;">Browse Products</a>
                    </div>
                `;
            }
        }

        // ========== AUTHENTICATION ==========

        function initializeAuth() {
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    appState.user = {
                        uid: user.uid,
                        email: user.email,
                        name: user.displayName || user.email.split('@')[0]
                    };
                    updateUserInterface();
                } else {
                    appState.user = null;
                    updateUserInterface();
                }
            });
        }

        function updateUserInterface() {
            const userProfile = document.getElementById('userProfile');
            const loginButton = document.getElementById('loginButton');
            
            if (userProfile && loginButton) {
                if (appState.user) {
                    userProfile.style.display = 'block';
                    loginButton.style.display = 'none';
                    
                    document.getElementById('profileName').textContent = appState.user.name;
                    document.getElementById('profileAvatar').textContent = appState.user.name.charAt(0).toUpperCase();
                    document.getElementById('dropdownUserName').textContent = appState.user.name;
                    document.getElementById('dropdownUserEmail').textContent = appState.user.email;
                } else {
                    userProfile.style.display = 'none';
                    loginButton.style.display = 'flex';
                }
            }
        }

        // ========== UI INITIALIZATION ==========

        function initializeUI() {
            initializeSearch();
            initializeUserProfile();
            initializeMobileMenu();
            initializeFullImageOverlay();
            initializeEnhancedSmartZoom();
        }

        function initializeSearch() {
            // Search functionality placeholder
            console.log(' Search initialized');
        }

        function initializeUserProfile() {
            const profileToggle = document.getElementById('profileToggle');
            const profileDropdown = document.getElementById('profileDropdown');
            
            if (profileToggle && profileDropdown) {
                profileToggle.addEventListener('click', function(event) {
                    event.stopPropagation();
                    profileDropdown.classList.toggle('active');
                });
                
                document.addEventListener('click', function() {
                    profileDropdown.classList.remove('active');
                });
            }
        }

        function initializeMobileMenu() {
            const trustMobileToggle = document.getElementById('trustMobileToggle');
            const mobileUsesMenu = document.getElementById('mobileUsesMenu');
            const closeMenu = document.getElementById('closeMenu');
            const menuOverlay = document.getElementById('menuOverlay');
            
            if (trustMobileToggle && mobileUsesMenu && closeMenu && menuOverlay) {
                trustMobileToggle.addEventListener('click', function() {
                    mobileUsesMenu.classList.add('active');
                    menuOverlay.classList.add('active');
                    document.body.style.overflow = 'hidden';
                });
                
                function closeMobileMenu() {
                    mobileUsesMenu.classList.remove('active');
                    menuOverlay.classList.remove('active');
                    document.body.style.overflow = 'auto';
                }
                
                closeMenu.addEventListener('click', closeMobileMenu);
                menuOverlay.addEventListener('click', closeMobileMenu);
                window.closeMobileMenu = closeMobileMenu;
            }
        }

        function initializeFullImageOverlay() {
            // Full image overlay functionality placeholder
            console.log(' Full image overlay initialized');
        }

        function initializeEnhancedSmartZoom() {
            // Zoom functionality placeholder
            console.log(' Zoom functionality initialized');
        }

        // ========== MAIN INITIALIZATION ==========

        document.addEventListener('DOMContentLoaded', function() {
            console.log(' Initializing Product Details Page...');
            
            loadCart();
            
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id');
            
            console.log(' Product ID from URL:', productId);
            
            if (!productId) {
                showError('No product ID specified. Please select a product from the catalog.');
                return;
            }
            
            initializePage(productId);
            initializeAuth();
            initializeUI();
            
            console.log(' Product Details page initialized successfully!');
        });
    </script>
</body>
</html>
