<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details - StoneCraft UK</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ===== REUSE MOST STYLES FROM CATEGORY PAGE ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #ffffff;
            color: #333;
            line-height: 1.6;
            padding-top: 120px;
            transition: padding-top 0.3s ease;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 5px 15px;
        }
        
        /* Header Styles - Same as category page */
        header {
            background-color: #fff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            transition: transform 0.4s ease;
            margin-top: 0;
            padding-top: 0;
        }
        
        header.hidden {
            transform: translateY(-100%);
        }
        
        header.visible {
            transform: translateY(0);
        }
        
        .main-header {
            padding: 5px 0;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
        }
        
        .logo h1 {
            font-size: 24px;
            color: #333;
            font-weight: 700;
        }
        
        .logo span {
            color: #b8860b;
        }
        
        .trust-info {
            flex: 1;
            text-align: center;
            padding: 0 10px;
            margin-top: 0;
            padding-top: 5px;
        }
        
        .trust-info-content {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            font-size: 13px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 5px 10px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }
        
        .trust-item {
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 6px;
        }
        
        .trust-item i {
            color: #b8860b;
            font-size: 14px;
        }

        /* User Profile Styles */
        .user-profile {
            position: relative;
        }

        .profile-toggle {
            display: flex;
            align-items: center;
            gap: 6px;
            background: none;
            border: none;
            cursor: pointer;
            padding: 6px 10px;
            border-radius: 6px;
            transition: background-color 0.3s;
        }

        .profile-toggle:hover {
            background: #f8f9fa;
        }

        .profile-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: #b8860b;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 12px;
        }

        .profile-name {
            font-size: 12px;
            font-weight: 500;
            color: #333;
        }

        .profile-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            min-width: 180px;
            z-index: 1000;
            display: none;
            border: 1px solid #e0e0e0;
        }

        .profile-dropdown.active {
            display: block;
        }

        .dropdown-header {
            padding: 12px;
            border-bottom: 1px solid #eee;
            background: #f8f9fa;
            border-radius: 8px 8px 0 0;
        }

        .dropdown-header .user-email {
            font-size: 11px;
            color: #666;
            margin-top: 4px;
        }

        .dropdown-menu {
            list-style: none;
            padding: 6px 0;
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            color: #333;
            text-decoration: none;
            font-size: 13px;
            transition: all 0.3s;
        }

        .dropdown-item:hover {
            background: #f8f9fa;
            color: #b8860b;
        }

        .dropdown-item i {
            width: 14px;
            text-align: center;
            color: #666;
            font-size: 13px;
        }

        .dropdown-divider {
            height: 1px;
            background: #eee;
            margin: 6px 0;
        }

        .user-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-action {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: #555;
            font-size: 11px;
            transition: color 0.3s;
        }

        .user-action:hover {
            color: #b8860b;
        }

        .user-action i {
            font-size: 18px;
            margin-bottom: 2px;
        }

        /* Advanced Search Styles */
        .search-container {
            position: relative;
            flex: 1;
            max-width: 450px;
            margin: 0 15px;
        }

        .search-input-container {
            position: relative;
            display: flex;
            align-items: center;
        }

        .search-input {
            width: 100%;
            padding: 10px 40px 10px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 20px;
            font-size: 13px;
            background-color: #f8f9fa;
        }

        .search-input:focus {
            outline: none;
            border-color: #b8860b;
            background-color: white;
        }

        .search-button {
            position: absolute;
            right: 6px;
            background: #b8860b;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            max-height: 350px;
            overflow-y: auto;
            z-index: 1001;
            display: none;
            margin-top: 5px;
        }

        .search-results.active {
            display: block;
        }

        .search-result-item {
            display: flex;
            align-items: center;
            padding: 10px 12px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
        }

        .search-result-item:hover {
            background: #f8f9fa;
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .search-result-image {
            width: 45px;
            height: 45px;
            border-radius: 6px;
            background-size: cover;
            background-position: center;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .search-result-content {
            flex: 1;
        }

        .search-result-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 3px;
            font-size: 13px;
        }

        .search-result-category {
            font-size: 11px;
            color: #b8860b;
            background: #fff9e6;
            padding: 2px 6px;
            border-radius: 10px;
            display: inline-block;
        }

        .search-result-price {
            font-weight: 700;
            color: #b8860b;
            font-size: 13px;
        }

        .no-results {
            padding: 15px;
            text-align: center;
            color: #666;
            font-size: 13px;
        }

        .search-loading {
            padding: 12px;
            text-align: center;
            color: #666;
            font-size: 13px;
        }

        .view-all-results {
            padding: 10px 12px;
            text-align: center;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
            font-size: 13px;
        }

        .view-all-results a {
            color: #b8860b;
            text-decoration: none;
            font-weight: 600;
        }
        
        /* Banner Text */
        .banner-text {
            background: linear-gradient(135deg, #b8860b, #a3780a);
            color: white;
            padding: 2px 0;
            text-align: center;
            font-size: 12px;
            font-weight: 500;
            margin: 0;
            line-height: 1.2;
        }
        
        /* Uses Top Bar - TUP USES BAR */
        .uses-top-bar {
            position: sticky;
            top: 0;
            background: #333;
            padding: 0;
            z-index: 999;
            transition: top 0.3s ease;
        }
        
        .uses-container {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
        }
        
        .use-item {
            flex: 1;
            min-width: 110px;
            position: relative; 
        }
        
        .use-link {
            display: block;
            color: white;
            text-decoration: none;
            padding: 12px 8px;
            font-size: 13px;
            font-weight: 500;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .use-link:hover {
            background: #b8860b;
        }
        
        /* Mega Menu Styles */
        .mega-menu {
            position: absolute;
            top: 100%;
            left: 0; 
            width: 100%; 
            background: white;
            z-index: 1000;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            display: none; 
            padding: 25px 0;
        }
        
        .use-item:hover .mega-menu {
            display: block;
        }
        
        .patterns-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 15px;
            padding: 0 15px;
        }
        
        .pattern-item {
            text-align: center;
            cursor: pointer;
            text-decoration: none;
            color: #333;
        }
        
        .pattern-image {
            width: 100%;
            height: 160px;
            background-size: cover;
            background-position: center;
            border-radius: 6px;
            margin-bottom: 8px;
            transition: transform 0.3s ease;
        }
        
        .pattern-item:hover .pattern-image {
            transform: scale(1.05);
        }
        
        .pattern-name {
            font-size: 13px;
            color: #333;
            font-weight: 500;
        }

        /* ===== PRODUCT DETAILS PAGE SPECIFIC STYLES ===== */
        .main-content {
            margin-top: 8px;
            padding: 2px 0px;
        }
        
        /* Page Header */
        .page-header {
            text-align: center;
            margin-bottom: 0px;
            padding: 22px 5px;
            background: url('https://plus.unsplash.com/premium_photo-1673567871911-c8a8c63d1c2b?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8OXx8c3RvbmV8ZW58MHx8MHx8fDA%3D') center/cover;
            border-radius: 8px;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            margin-top: 1px;
        }
        
        .page-header h1 {
            font-size: 28px;
            color: white;
            margin-bottom: 5px;
            line-height: 1.2;
        }
        
        .page-header .breadcrumb {
            color: white;
            font-size: 14px;
            opacity: 0.9;
        }
        
        .page-header .breadcrumb a {
            color: #fff;
            text-decoration: none;
            font-weight: 500;
        }
        
        .page-header .breadcrumb span {
            margin: 0 8px;
            color: rgba(255,255,255,0.7);
        }
        
        /* Product Details Layout */
        .product-details-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin: 30px 0;
        }
        
        /* ===== SMART ZOOM FEATURE ===== */
        .product-gallery {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .main-image-container {
            width: 100%;
            aspect-ratio: 1 / 1;
            overflow: hidden;
            border-radius: 10px;
            margin-bottom: 15px;
            position: relative;
            cursor: crosshair;
        }
        
        .main-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }
        
        .image-zoom-lens {
            position: absolute;
            border: 2px solid #b8860b;
            background: rgba(184, 134, 11, 0.2);
            pointer-events: none;
            display: none;
            z-index: 100;
        }
        
        .image-zoom-result {
            position: absolute;
            top: 0;
            right: -400px;
            width: 400px;
            height: 400px;
            border: 2px solid #b8860b;
            border-radius: 8px;
            background: white;
            overflow: hidden;
            display: none;
            z-index: 101;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }
        
        .image-zoom-result img {
            position: absolute;
            max-width: none;
            max-height: none;
        }
        
        .zoom-active .image-zoom-lens,
        .zoom-active .image-zoom-result {
            display: block;
        }
        
        /* Zoom controls */
        .zoom-controls {
            position: absolute;
            bottom: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
            z-index: 102;
        }
        
        .zoom-btn {
            width: 32px;
            height: 32px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
            color: #333;
            transition: all 0.3s;
        }
        
        .zoom-btn:hover {
            background: #b8860b;
            color: white;
            border-color: #b8860b;
        }
        
        .thumbnail-gallery {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 10px 0;
        }
        
        .thumbnail {
            width: 80px;
            height: 80px;
            border-radius: 5px;
            cursor: pointer;
            object-fit: cover;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .thumbnail.active {
            border-color: #b8860b;
        }
        
        .thumbnail:hover {
            transform: scale(1.05);
        }
        
        /* Product Info */
        .product-info {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .product-title {
            font-size: 32px;
            color: #333;
            margin-bottom: 10px;
        }
        
        .product-category {
            font-size: 16px;
            color: #b8860b;
            background: #fff9e6;
            padding: 5px 12px;
            border-radius: 20px;
            display: inline-block;
            margin-bottom: 20px;
            font-weight: 500;
        }
        
        .product-price {
            font-size: 36px;
            color: #b8860b;
            font-weight: 700;
            margin-bottom: 25px;
        }
        
        .product-price-unit {
            font-size: 16px;
            color: #666;
            font-weight: normal;
        }
        
        .product-description-full {
            font-size: 16px;
            line-height: 1.7;
            color: #555;
            margin-bottom: 30px;
        }
        
        /* Specifications Table */
        .specifications {
            margin: 30px 0;
        }
        
        .specifications h3 {
            font-size: 20px;
            margin-bottom: 15px;
            color: #333;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }
        
        .specs-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .specs-table tr {
            border-bottom: 1px solid #eee;
        }
        
        .specs-table td {
            padding: 12px 0;
        }
        
        .spec-label {
            font-weight: 600;
            color: #333;
            width: 40%;
        }
        
        .spec-value {
            color: #666;
        }
        
        /* Contact Info */
        .contact-info {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
        }
        
        .contact-info h3 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #333;
        }
        
        .contact-details {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .contact-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            flex: 1;
            min-width: 200px;
        }
        
        .contact-item i {
            color: #b8860b;
            font-size: 18px;
        }
        
        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 15px 25px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            font-size: 16px;
        }
        
        .primary-btn {
            background: #b8860b;
            color: white;
            flex: 1;
        }
        
        .secondary-btn {
            background: #f0f0f0;
            color: #333;
            flex: 1;
        }
        
        .primary-btn:hover {
            background: #a3780a;
            transform: translateY(-2px);
        }
        
        .secondary-btn:hover {
            background: #e0e0e0;
            transform: translateY(-2px);
        }
        
        /* Related Products Section */
        .related-products {
            margin: 60px 0 40px;
        }
        
        .section-title {
            font-size: 28px;
            color: #333;
            margin-bottom: 30px;
            text-align: center;
            position: relative;
            padding-bottom: 15px;
        }
        
        .section-title:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 3px;
            background: #b8860b;
        }
        
        /* PERFECT 1:1 RATIO E-COMMERCE PRODUCT CARDS - 4 PER ROW */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            padding: 8px;
        }

        .product-card {
            padding: 4px;
            text-align: left;
            display: flex;
            flex-direction: column;
            height: 100%;
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        /* PERFECT 1:1 RATIO IMAGE BOX */
        .product-img-box {
            width: 100%;
            aspect-ratio: 1 / 1;
            overflow: hidden;
            border-radius: 8px;
            background: #f8f9fa;
            position: relative;
        }

        .product-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .product-img:hover {
            transform: scale(1.05);
        }

        .product-description {
            margin-top: 8px;
            font-size: 13px;
            color: #333;
            line-height: 1.4;
            flex-grow: 1;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .product-rate {
            margin-top: 5px;
            font-size: 15px;
            font-weight: bold;
            color: #b8860b;
        }

        .details-btn {
            display: inline-block;
            margin-top: 6px;
            padding: 6px 12px;
            font-size: 13px;
            background: #b8860b;
            color: white;
            border-radius: 5px;
            text-decoration: none;
            transition: background 0.3s ease;
            text-align: center;
            width: 100%;
        }

        .details-btn:hover {
            background: #a3780a;
        }
        
        /* Features Section */
        .features {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 25px;
            margin: 40px 0;
            padding: 40px 0;
            background-color: #f9f9f9;
        }
        
        .feature {
            text-align: center;
            padding: 25px 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        
        .feature i {
            font-size: 35px;
            color: #b8860b;
            margin-bottom: 15px;
        }
        
        .feature h3 {
            margin-bottom: 12px;
            font-size: 18px;
            color: #333;
        }
        
        .feature p {
            font-size: 14px;
            color: #666;
            line-height: 1.5;
        }
        
        /* Footer */
        footer {
            background-color: #222;
            color: #ddd;
            padding: 40px 0 15px;
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 25px;
            margin-bottom: 25px;
        }
        
        .footer-column h3 {
            color: white;
            margin-bottom: 15px;
            font-size: 16px;
            padding-bottom: 6px;
            border-bottom: 2px solid #b8860b;
            display: inline-block;
        }
        
        .footer-links {
            list-style: none;
        }
        
        .footer-links li {
            margin-bottom: 8px;
        }
        
        .footer-links a {
            color: #ddd;
            text-decoration: none;
            font-size: 13px;
            transition: color 0.3s;
        }
        
        .footer-links a:hover {
            color: #b8860b;
        }
        
        .social-links {
            display: flex;
            gap: 10px;
            margin-top: 12px;
        }
        
        .social-links a {
            color: white;
            background: #444;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s;
            font-size: 13px;
        }
        
        .social-links a:hover {
            background: #b8860b;
        }
        
        .copyright {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid #444;
            font-size: 12px;
            color: #999;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .products-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .product-details-layout {
                grid-template-columns: 1fr;
                gap: 30px;
            }
            
            .image-zoom-result {
                right: -300px;
                width: 300px;
                height: 300px;
            }
            
            .features {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .footer-content {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .patterns-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            body {
                padding-top: 100px;
            }
            
            .main-content {
                margin-top: 5px;
            }
            
            .header-content {
                flex-wrap: wrap;
            }
            
            .trust-info {
                order: 3;
                flex-basis: 100%;
                margin-top: 8px;
                padding: 0;
            }
            
            .search-container {
                order: 4;
                flex-basis: 100%;
                margin: 8px 0 0;
                max-width: 100%;
            }
            
            .image-zoom-result {
                right: -200px;
                width: 200px;
                height: 200px;
            }
            
            .features {
                grid-template-columns: 1fr;
                padding: 30px 0;
                margin: 30px 0;
            }
            
            .uses-top-bar {
                display: block;
            }
            
            .profile-name {
                display: none;
            }
            
            .patterns-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .products-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .page-header h1 {
                font-size: 24px;
            }
            
            .product-title {
                font-size: 28px;
            }
            
            .product-price {
                font-size: 30px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding-top: 190px;
            }
            
            .products-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .image-zoom-result {
                display: none !important;
            }
            
            .zoom-btn {
                display: none;
            }
            
            .footer-content {
                grid-template-columns: 1fr;
            }
            
            .patterns-grid {
                grid-template-columns: 1fr;
            }
            
            .page-header {
                padding: 8px 0;
                margin-bottom: 3px;
                min-height: 50px;
            }
            
            .page-header h1 {
                font-size: 22px;
            }
            
            .product-info {
                padding: 20px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- ===== HEADER - SAME AS CATEGORY PAGE ===== -->
    <header id="mainHeader">
        <div class="trust-info">
            <div class="trust-info-content">
                <div class="trust-item">
                    <i class="fas fa-truck"></i>
                    <span>Free UK Delivery</span>
                </div>
                <div class="trust-item">
                    <i class="fas fa-star"></i>
                    <span>Rated 4.8/5</span>
                </div>
                <div class="trust-item">
                    <i class="fas fa-award"></i>
                    <span>BSF Member</span>
                </div>
            </div>
        </div>

        <!-- Main Header -->
        <div class="main-header">
            <div class="container header-content">
                <div class="logo">
                    <a href="index.html" style="text-decoration: none; color: inherit;">
                        <h1>Stone<span>Craft</span></h1>
                    </a>
                </div>
                
                <!-- Advanced Search -->
                <div class="search-container">
                    <div class="search-input-container">
                        <input type="text" class="search-input" id="searchInput" placeholder="Search for stones, products, categories...">
                        <button class="search-button" id="searchButton">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                    <div class="search-results" id="searchResults">
                        <!-- Search results will be dynamically loaded here -->
                    </div>
                </div>
                
                <div class="user-actions">
                    <!-- Dynamic User Profile -->
                    <div class="user-profile" id="userProfile" style="display: none;">
                        <button class="profile-toggle" id="profileToggle">
                            <div class="profile-avatar" id="profileAvatar">U</div>
                            <span class="profile-name" id="profileName">User</span>
                            <i class="fas fa-chevron-down" style="font-size: 11px;"></i>
                        </button>
                        <div class="profile-dropdown" id="profileDropdown">
                            <div class="dropdown-header">
                                <div class="profile-name" id="dropdownUserName">User Name</div>
                                <div class="user-email" id="dropdownUserEmail">user@example.com</div>
                            </div>
                            <ul class="dropdown-menu">
                                <li><a href="dashboard.html" class="dropdown-item"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                                <li><a href="add.html" class="dropdown-item"><i class="fas fa-plus-circle"></i> Add Product</a></li>
                                <li><a href="edit-profile.html" class="dropdown-item"><i class="fas fa-user-edit"></i> Edit Profile</a></li>
                                <li><a href="wishlist.html" class="dropdown-item"><i class="fas fa-heart"></i> My Wishlist</a></li>
                                <li><a href="billing.html" class="dropdown-item"><i class="fas fa-address-card"></i> Billing/Shipping</a></li>
                                <li><a href="orders.html" class="dropdown-item"><i class="fas fa-history"></i> Order History</a></li>
                                <li class="dropdown-divider"></li>
                                <li><a href="#" class="dropdown-item" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- Add Product Button -->
                    <a href="add.html" class="user-action" id="addProductButton" style="display: none;">
                        <i class="fas fa-plus-circle"></i>
                        <span>Add Product</span>
                    </a>
                    
                    <!-- Login Button -->
                    <a href="login.html" class="user-action" id="loginButton">
                        <i class="fas fa-user"></i>
                        <span>Sign In</span>
                    </a>
                    
                    <a href="#" class="user-action">
                        <i class="fas fa-shopping-cart"></i>
                        <span>Cart (0)</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- Banner Text -->
        <div class="banner-text">
            <div class="container">
                Premium Natural Stone Collections - Sandstone, Marble & Limestone for UK Homes & Commercial Projects
            </div>
        </div>
    </header>

    <!-- Desktop Uses Top Bar with Mega Menu - TUP USES BAR -->
    <div class="uses-top-bar">
        <div class="container uses-container" id="dynamicUsesContainer">
            <!-- Dynamic uses will be loaded here -->
            <div class="loading-categories">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading navigation...</p>
            </div>
        </div>
    </div>

    <!-- ===== MAIN CONTENT ===== -->
    <div class="main-content">
        <div class="container">
            <!-- Page Header -->
            <div class="page-header">
                <h1 id="pageTitle">Product Details</h1>
                <div class="breadcrumb" id="breadcrumb">
                    <a href="index.html">Home</a>
                    <span>></span>
                    <a href="category-products.html">Products</a>
                    <span>></span>
                    <span id="productNameBreadcrumb">Product Name</span>
                </div>
            </div>
            
            <!-- Product Details -->
            <div id="productDetailsContainer">
                <div class="loading-products">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Loading product details...</p>
                </div>
            </div>
            
            <!-- Related Products Section -->
            <div class="related-products">
                <h2 class="section-title">Related Products</h2>
                <div id="relatedProductsGrid" class="products-grid">
                    <div class="loading-products">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading related products...</p>
                    </div>
                </div>
            </div>

            <!-- ===== FEATURES SECTION ===== -->
            <section class="features">
                <div class="container">
                    <div class="feature">
                        <i class="fas fa-shipping-fast"></i>
                        <h3>Free UK Delivery</h3>
                        <p>Free delivery on all orders across the United Kingdom with no minimum spend required. Fast and reliable shipping.</p>
                    </div>
                    <div class="feature">
                        <i class="fas fa-award"></i>
                        <h3>Quality Guaranteed</h3>
                        <p>All our stones are sourced from trusted quarries and come with quality certification and warranty.</p>
                    </div>
                    <div class="feature">
                        <i class="fas fa-headset"></i>
                        <h3>Expert Support</h3>
                        <p>Get expert advice from our stone specialists for your project requirements. We're here to help you choose the perfect stone.</p>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- ===== FOOTER ===== -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>StoneCraft</h3>
                    <ul class="footer-links">
                        <li><a href="index.html">Home</a></li>
                        <li><a href="add.html">Add Product</a></li>
                        <li><a href="#">About Us</a></li>
                        <li><a href="#">Our Story</a></li>
                        <li><a href="#">Sustainability</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Products</h3>
                    <ul class="footer-links">
                        <li><a href="category-products.html?usage=flooring">Flooring Stones</a></li>
                        <li><a href="category-products.html?usage=wall">Wall Stones</a></li>
                        <li><a href="category-products.html?usage=bathroom">Bathroom Stones</a></li>
                        <li><a href="category-products.html?usage=outdoor">Outdoor Stones</a></li>
                        <li><a href="category-products.html?usage=kitchen">Kitchen Stones</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Support</h3>
                    <ul class="footer-links">
                        <li><a href="#">Contact Us</a></li>
                        <li><a href="#">Delivery Info</a></li>
                        <li><a href="#">Returns Policy</a></li>
                        <li><a href="#">Installation Guide</a></li>
                        <li><a href="#">FAQ</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Legal</h3>
                    <ul class="footer-links">
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="#">Terms of Service</a></li>
                        <li><a href="#">Cookie Policy</a></li>
                        <li><a href="#">Disclaimer</a></li>
                        <li><a href="#">Sitemap</a></li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2024 StoneCraft UK. All rights reserved. | Registered in England No: 12345678</p>
            </div>
        </div>
    </footer>

    <!-- Smart Scroll Behavior Script -->
    <script>
        // Smart Scroll Behavior for Header - Always hidden except at top
        document.addEventListener('DOMContentLoaded', function() {
            const header = document.getElementById('mainHeader');
            let lastScrollY = window.scrollY;
            let ticking = false;
            
            function updateHeader() {
                const currentScrollY = window.scrollY;
                
                // Always hide header when scrolled down from top
                if (currentScrollY > 50) {
                    header.classList.add('hidden');
                    header.classList.remove('visible');
                } else {
                    // Only show when at the very top
                    header.classList.remove('hidden');
                    header.classList.add('visible');
                }
                
                lastScrollY = currentScrollY;
                ticking = false;
            }
            
            function onScroll() {
                if (!ticking) {
                    requestAnimationFrame(updateHeader);
                    ticking = true;
                }
            }
            
            window.addEventListener('scroll', onScroll, { passive: true });
            
            // Initialize header as visible (at top)
            header.classList.add('visible');
        });
    </script>

    <!-- Firebase Script -->
    <script type="module">
        import { 
            db, auth, 
            collection, getDocs, doc, getDoc,
            onAuthStateChanged, signOut
        } from './firebase-config.js';

        const appState = {
            currentProduct: null,
            allProducts: [],
            relatedProducts: [],
            user: null
        };

        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Initializing Product Details Page...');
            
            // Get product ID from URL
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id');
            
            console.log('üìã Product ID from URL:', productId);
            
            if (!productId) {
                showError('No product ID specified');
                return;
            }
            
            // Initialize the page
            initializePage(productId);
            initializeAuth();
            initializeUI();
        });

        // ===== REUSABLE FUNCTIONS FROM CATEGORY PAGE =====
        
        // Initialize UI components
        function initializeUI() {
            initializeSearch();
            initializeUserProfile();
        }

        // Initialize search functionality
        function initializeSearch() {
            const searchInput = document.getElementById('searchInput');
            const searchButton = document.getElementById('searchButton');
            const searchResults = document.getElementById('searchResults');
            
            if (!searchInput || !searchButton || !searchResults) return;
            
            searchButton.addEventListener('click', performSearch);
            searchInput.addEventListener('keyup', function(event) {
                if (event.key === 'Enter') {
                    performSearch();
                }
            });
            
            searchInput.addEventListener('input', function() {
                if (searchInput.value.length > 2) {
                    performSearch();
                } else {
                    searchResults.classList.remove('active');
                }
            });
            
            function performSearch() {
                const query = searchInput.value.trim().toLowerCase();
                
                if (query.length < 2) {
                    searchResults.classList.remove('active');
                    return;
                }
                
                // Show loading state
                searchResults.innerHTML = '<div class="search-loading"><i class="fas fa-spinner fa-spin"></i> Searching...</div>';
                searchResults.classList.add('active');
                
                // Simulate API delay
                setTimeout(() => {
                    const results = appState.allProducts.filter(product => 
                        (product.stone_name && product.stone_name.toLowerCase().includes(query)) ||
                        (product.uses && product.uses.toLowerCase().includes(query)) ||
                        (product.type && product.type.toLowerCase().includes(query)) ||
                        (product.category && product.category.toLowerCase().includes(query))
                    );
                    
                    displaySearchResults(results, query);
                }, 300);
            }
            
            function displaySearchResults(results, query) {
                searchResults.innerHTML = '';
                
                if (results.length === 0) {
                    searchResults.innerHTML = '<div class="no-results">No products found for "' + query + '"</div>';
                    return;
                }
                
                results.forEach(product => {
                    const resultItem = document.createElement('div');
                    resultItem.className = 'search-result-item';
                    resultItem.innerHTML = `
                        <div class="search-result-image" style="background-image: url('${product.images?.[0] || getDefaultImage(product.category)}')"></div>
                        <div class="search-result-content">
                            <div class="search-result-name">${product.stone_name || 'Stone Product'}</div>
                            <div class="search-result-category">${product.uses || 'General'} ‚Ä¢ ${product.category || 'Natural Stone'}</div>
                        </div>
                        <div class="search-result-price">${product.price ? '¬£' + product.price : 'Price on request'}</div>
                    `;
                    
                    resultItem.addEventListener('click', function() {
                        window.location.href = `product-details.html?id=${product.id}`;
                    });
                    
                    searchResults.appendChild(resultItem);
                });
                
                // Add "View all results" link
                const viewAll = document.createElement('div');
                viewAll.className = 'view-all-results';
                viewAll.innerHTML = `<a href="search-results.html?q=${encodeURIComponent(query)}">View all ${results.length} results</a>`;
                searchResults.appendChild(viewAll);
            }
            
            // Close search results when clicking outside
            document.addEventListener('click', function(event) {
                if (!searchResults.contains(event.target) && event.target !== searchInput && event.target !== searchButton) {
                    searchResults.classList.remove('active');
                }
            });
        }

        // Initialize user profile dropdown
        function initializeUserProfile() {
            const profileToggle = document.getElementById('profileToggle');
            const profileDropdown = document.getElementById('profileDropdown');
            const logoutBtn = document.getElementById('logoutBtn');
            
            if (!profileToggle || !profileDropdown) return;
            
            profileToggle.addEventListener('click', function(event) {
                event.stopPropagation();
                profileDropdown.classList.toggle('active');
            });
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function() {
                profileDropdown.classList.remove('active');
            });
            
            // Logout functionality
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function(event) {
                    event.preventDefault();
                    signOut(auth).then(() => {
                        console.log('User signed out');
                    }).catch((error) => {
                        console.error('Sign out error:', error);
                    });
                });
            }
        }

        // ===== PRODUCT DETAILS SPECIFIC FUNCTIONS =====

        async function initializePage(productId) {
            try {
                console.log('üîÑ Starting page initialization...');
                await loadAllProductsFromFirestore();
                await loadProductDetails(productId);
                
                // Initialize uses navigation (TUP USES BAR)
                generateUsesNavigation();
                
                console.log('‚úÖ Page initialization completed successfully!');
            } catch (error) {
                console.error('‚ùå Error initializing page:', error);
                showError('Failed to load product details');
            }
        }

        async function loadAllProductsFromFirestore() {
            try {
                console.log('üî• Loading all products from Firestore...');
                const querySnapshot = await getDocs(collection(db, "products"));
                appState.allProducts = [];
                
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    
                    // Handle additional_fields array properly
                    let processedData = { ...data };
                    
                    if (data.additional_fields && Array.isArray(data.additional_fields)) {
                        data.additional_fields.forEach(field => {
                            if (field && typeof field === 'object') {
                                processedData = { ...processedData, ...field };
                            }
                        });
                    }
                    
                    appState.allProducts.push({
                        id: doc.id,
                        ...processedData
                    });
                });
                
                console.log('‚úÖ All products loaded:', appState.allProducts.length);
                
            } catch (error) {
                console.error('‚ùå Error loading products from Firestore:', error);
                // Fallback to sample data if Firebase fails
                appState.allProducts = getSampleProducts();
            }
        }

        async function loadProductDetails(productId) {
            try {
                console.log(`üîÑ Loading product details for ID: ${productId}`);
                
                // Try to get from Firestore first
                const productRef = doc(db, "products", productId);
                const productSnap = await getDoc(productRef);
                
                if (productSnap.exists()) {
                    const data = productSnap.data();
                    let processedData = { ...data };
                    
                    // Handle additional_fields array properly
                    if (data.additional_fields && Array.isArray(data.additional_fields)) {
                        data.additional_fields.forEach(field => {
                            if (field && typeof field === 'object') {
                                processedData = { ...processedData, ...field };
                            }
                        });
                    }
                    
                    appState.currentProduct = {
                        id: productSnap.id,
                        ...processedData
                    };
                    
                    console.log('‚úÖ Product loaded from Firestore:', appState.currentProduct.stone_name);
                } else {
                    // Fallback to find in allProducts array
                    appState.currentProduct = appState.allProducts.find(p => p.id === productId);
                    
                    if (!appState.currentProduct) {
                        // Last resort: use first sample product
                        appState.currentProduct = getSampleProducts()[0];
                        console.log('‚ö†Ô∏è Using sample product data');
                    }
                }
                
                // Update page with product details
                displayProductDetails();
                loadRelatedProducts();
                
            } catch (error) {
                console.error('‚ùå Error loading product details:', error);
                // Use sample data as fallback
                appState.currentProduct = getSampleProducts().find(p => p.id == productId) || getSampleProducts()[0];
                displayProductDetails();
                loadRelatedProducts();
            }
        }

        function displayProductDetails() {
            const product = appState.currentProduct;
            if (!product) {
                showError('Product not found');
                return;
            }
            
            // Update page title
            document.getElementById('pageTitle').textContent = product.stone_name || 'Product Details';
            document.getElementById('productNameBreadcrumb').textContent = product.stone_name || 'Product';
            
            // Get images - handle multiple images
            const images = product.images || [];
            if (images.length === 0 && product.image) {
                images.push(product.image);
            }
            if (images.length === 0) {
                images.push(getDefaultImage(product.category));
            }
            
            // Create product details HTML
            const productHTML = `
                <div class="product-details-layout">
                    <!-- Product Images Gallery with SMART ZOOM -->
                    <div class="product-gallery">
                        <div class="main-image-container" id="zoomContainer">
                            <img src="${images[0]}" alt="${product.stone_name}" class="main-image" id="mainProductImage">
                            <div class="image-zoom-lens" id="zoomLens"></div>
                            <div class="image-zoom-result" id="zoomResult">
                                <img id="zoomedImage" src="${images[0]}" alt="Zoomed view">
                            </div>
                            <div class="zoom-controls">
                                <button class="zoom-btn" id="zoomInBtn" title="Zoom In">+</button>
                                <button class="zoom-btn" id="zoomOutBtn" title="Zoom Out">-</button>
                                <button class="zoom-btn" id="zoomResetBtn" title="Reset Zoom">‚Ü∫</button>
                            </div>
                        </div>
                        
                        ${images.length > 1 ? `
                        <div class="thumbnail-gallery">
                            ${images.map((img, index) => `
                                <img src="${img}" alt="Thumbnail ${index + 1}" class="thumbnail ${index === 0 ? 'active' : ''}" 
                                     data-index="${index}" onclick="changeMainImage(this)">
                            `).join('')}
                        </div>
                        ` : ''}
                    </div>
                    
                    <!-- Product Information -->
                    <div class="product-info">
                        <h1 class="product-title">${product.stone_name || 'Stone Product'}</h1>
                        <div class="product-category">${product.category || 'Natural Stone'}</div>
                        
                        <div class="product-price">
                            ¬£${product.price || 'Contact for price'}
                            ${product.price_unit ? `<span class="product-price-unit">per ${product.price_unit}</span>` : ''}
                        </div>
                        
                        <div class="product-description-full">
                            ${product.description || 'No description available.'}
                        </div>
                        
                        <!-- Specifications -->
                        <div class="specifications">
                            <h3>Specifications</h3>
                            <table class="specs-table">
                                ${product.type ? `
                                <tr>
                                    <td class="spec-label">Type</td>
                                    <td class="spec-value">${product.type}</td>
                                </tr>
                                ` : ''}
                                
                                ${product.color ? `
                                <tr>
                                    <td class="spec-label">Color</td>
                                    <td class="spec-value">${product.color}</td>
                                </tr>
                                ` : ''}
                                
                                ${product.size ? `
                                <tr>
                                    <td class="spec-label">Size</td>
                                    <td class="spec-value">${product.size}</td>
                                </tr>
                                ` : ''}
                                
                                ${product.thickness ? `
                                <tr>
                                    <td class="spec-label">Thickness</td>
                                    <td class="spec-value">${product.thickness}</td>
                                </tr>
                                ` : ''}
                                
                                ${product.finish ? `
                                <tr>
                                    <td class="spec-label">Finish</td>
                                    <td class="spec-value">${product.finish}</td>
                                </tr>
                                ` : ''}
                                
                                ${product.density ? `
                                <tr>
                                    <td class="spec-label">Density</td>
                                    <td class="spec-value">${product.density}</td>
                                </tr>
                                ` : ''}
                                
                                ${product.water_absorption ? `
                                <tr>
                                    <td class="spec-label">Water Absorption</td>
                                    <td class="spec-value">${product.water_absorption}</td>
                                </tr>
                                ` : ''}
                                
                                ${product.compressive_strength ? `
                                <tr>
                                    <td class="spec-label">Compressive Strength</td>
                                    <td class="spec-value">${product.compressive_strength}</td>
                                </tr>
                                ` : ''}
                                
                                ${product.uses ? `
                                <tr>
                                    <td class="spec-label">Best For</td>
                                    <td class="spec-value">${product.uses}</td>
                                </tr>
                                ` : ''}
                            </table>
                        </div>
                        
                        <!-- Contact Information -->
                        ${product.factory_name || product.contact_number || product.email ? `
                        <div class="contact-info">
                            <h3>Contact Supplier</h3>
                            <div class="contact-details">
                                ${product.factory_name ? `
                                <div class="contact-item">
                                    <i class="fas fa-industry"></i>
                                    <span>${product.factory_name}</span>
                                </div>
                                ` : ''}
                                
                                ${product.contact_number ? `
                                <div class="contact-item">
                                    <i class="fas fa-phone"></i>
                                    <span>${product.contact_number}</span>
                                </div>
                                ` : ''}
                                
                                ${product.email ? `
                                <div class="contact-item">
                                    <i class="fas fa-envelope"></i>
                                    <span>${product.email}</span>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                        ` : ''}
                        
                        <!-- Action Buttons -->
                        <div class="action-buttons">
                            <a href="#" class="action-btn primary-btn" id="inquireBtn">
                                <i class="fas fa-envelope"></i>
                                Inquire Now
                            </a>
                            <a href="category-products.html?usage=${product.uses ? product.uses.toLowerCase().replace(/\s+/g, '-') : ''}" class="action-btn secondary-btn">
                                <i class="fas fa-th-large"></i>
                                View Similar Products
                            </a>
                        </div>
                    </div>
                </div>
            `;
            
            // Insert into page
            document.getElementById('productDetailsContainer').innerHTML = productHTML;
            
            // Initialize smart zoom
            setTimeout(() => {
                initializeSmartZoom();
            }, 100);
            
            // Add event listener for inquire button
            document.getElementById('inquireBtn')?.addEventListener('click', function(e) {
                e.preventDefault();
                showInquiryForm();
            });
        }

        // SMART ZOOM FUNCTIONALITY
        function initializeSmartZoom() {
            const zoomContainer = document.getElementById('zoomContainer');
            const mainImage = document.getElementById('mainProductImage');
            const zoomLens = document.getElementById('zoomLens');
            const zoomResult = document.getElementById('zoomResult');
            const zoomedImage = document.getElementById('zoomedImage');
            const zoomInBtn = document.getElementById('zoomInBtn');
            const zoomOutBtn = document.getElementById('zoomOutBtn');
            const zoomResetBtn = document.getElementById('zoomResetBtn');
            
            if (!zoomContainer || !mainImage) return;
            
            let zoomLevel = 2; // Default zoom level
            let isZoomActive = false;
            
            // Wait for image to load
            mainImage.onload = function() {
                // Set lens size (20% of image size)
                zoomLens.style.width = (this.width * 0.2) + "px";
                zoomLens.style.height = (this.height * 0.2) + "px";
                
                // Initialize zoom
                updateZoom();
            };
            
            // If image is already loaded
            if (mainImage.complete) {
                zoomLens.style.width = (mainImage.width * 0.2) + "px";
                zoomLens.style.height = (mainImage.height * 0.2) + "px";
                updateZoom();
            }
            
            // Zoom in/out controls
            if (zoomInBtn) {
                zoomInBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    zoomLevel = Math.min(zoomLevel + 0.5, 5);
                    updateZoom();
                });
            }
            
            if (zoomOutBtn) {
                zoomOutBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    zoomLevel = Math.max(zoomLevel - 0.5, 1);
                    updateZoom();
                });
            }
            
            if (zoomResetBtn) {
                zoomResetBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    zoomLevel = 2;
                    updateZoom();
                });
            }
            
            function updateZoom() {
                if (zoomedImage) {
                    zoomedImage.style.transform = `scale(${zoomLevel})`;
                }
            }
            
            // Execute when mouse moves over image
            zoomContainer.addEventListener("mousemove", moveLens);
            zoomContainer.addEventListener("mouseenter", function() {
                isZoomActive = true;
                zoomContainer.classList.add('zoom-active');
            });
            zoomContainer.addEventListener("mouseleave", function() {
                isZoomActive = false;
                zoomContainer.classList.remove('zoom-active');
            });
            
            function moveLens(e) {
                if (!isZoomActive) return;
                
                e.preventDefault();
                
                // Get cursor position
                const pos = getCursorPos(e);
                let x = pos.x - (zoomLens.offsetWidth / 2);
                let y = pos.y - (zoomLens.offsetHeight / 2);
                
                // Prevent lens from being positioned outside the image
                if (x > mainImage.width - zoomLens.offsetWidth) x = mainImage.width - zoomLens.offsetWidth;
                if (x < 0) x = 0;
                if (y > mainImage.height - zoomLens.offsetHeight) y = mainImage.height - zoomLens.offsetHeight;
                if (y < 0) y = 0;
                
                // Set lens position
                zoomLens.style.left = x + "px";
                zoomLens.style.top = y + "px";
                
                // Calculate zoomed image position
                const zoomRatio = 2; // Zoom ratio
                const zoomedX = x * zoomLevel;
                const zoomedY = y * zoomLevel;
                
                // Position zoomed image
                if (zoomedImage) {
                    zoomedImage.style.left = `-${zoomedX}px`;
                    zoomedImage.style.top = `-${zoomedY}px`;
                }
            }
            
            function getCursorPos(e) {
                const a = zoomContainer.getBoundingClientRect();
                let x = e.pageX - a.left;
                let y = e.pageY - a.top;
                
                // Consider page scrolling
                x = x - window.pageXOffset;
                y = y - window.pageYOffset;
                
                return {x: x, y: y};
            }
            
            // Initialize zoom
            updateZoom();
        }

        function changeMainImage(thumbnail) {
            const mainImage = document.getElementById('mainProductImage');
            const zoomResult = document.getElementById('zoomResult');
            const zoomedImage = document.getElementById('zoomedImage');
            
            if (mainImage && thumbnail.src) {
                mainImage.src = thumbnail.src;
                
                // Update zoom image
                if (zoomedImage) {
                    zoomedImage.src = thumbnail.src;
                }
                
                // Update active thumbnail
                document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
                thumbnail.classList.add('active');
                
                // Reinitialize zoom for new image
                setTimeout(() => {
                    initializeSmartZoom();
                }, 100);
            }
        }

        // Generate TUP USES BAR navigation
        function generateUsesNavigation() {
            const usesContainer = document.getElementById('dynamicUsesContainer');
            if (!usesContainer || appState.allProducts.length === 0) return;
            
            usesContainer.innerHTML = '';
            
            // Get unique uses from products
            const uniqueUses = [...new Set(appState.allProducts
                .filter(product => product.uses && product.uses.trim() !== '')
                .map(product => product.uses.trim())
            )].sort();
            
            if (uniqueUses.length === 0) {
                usesContainer.innerHTML = `
                    <div class="loading-categories">
                        <i class="fas fa-info-circle"></i>
                        <p>No uses found</p>
                    </div>
                `;
                return;
            }
            
            uniqueUses.forEach(usage => {
                const usageKey = usage.toLowerCase().replace(/\s+/g, '-');
                const useItem = document.createElement('div');
                useItem.className = 'use-item';
                
                // Get products for this usage
                const usageProducts = appState.allProducts.filter(product => 
                    product.uses && product.uses.toLowerCase() === usage.toLowerCase()
                );
                
                const uniqueStoneNames = [...new Set(usageProducts
                    .filter(product => product.stone_name)
                    .map(product => product.stone_name)
                )];
                
                if (uniqueStoneNames.length > 0) {
                    // Usage with stone names - create mega menu
                    useItem.innerHTML = `
                        <div class="use-link">${usage} (${usageProducts.length})</div>
                        <div class="mega-menu">
                            <div class="patterns-grid">
                                ${uniqueStoneNames.map(stoneName => {
                                    const stoneSlug = stoneName.toLowerCase().replace(/\s+/g, '-');
                                    // Find a product image for this stone or use default
                                    const stoneProduct = appState.allProducts.find(p => 
                                        p.uses && p.uses.toLowerCase() === usage.toLowerCase() && 
                                        p.stone_name === stoneName
                                    );
                                    const imageUrl = stoneProduct?.images?.[0] || getDefaultImage(stoneProduct?.category);
                                    
                                    return `
                                        <a href="category-products.html?usage=${usageKey}&stone=${stoneSlug}" class="pattern-item" data-usage="${usage}" data-stone="${stoneName}">
                                            <div class="pattern-image" style="background-image: url('${imageUrl}')"></div>
                                            <div class="pattern-name">${stoneName}</div>
                                        </a>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    `;
                } else {
                    // Usage with products but no stone names - simple link
                    useItem.innerHTML = `
                        <a href="category-products.html?usage=${usageKey}" class="use-link">${usage} (${usageProducts.length})</a>
                    `;
                }
                
                usesContainer.appendChild(useItem);
            });
            
            // Initialize mega menu functionality
            initializeMegaMenu();
        }

        // Initialize mega menu functionality for TUP USES BAR
        function initializeMegaMenu() {
            const usesTopBar = document.querySelector('.uses-top-bar');
            const container = document.querySelector('.uses-top-bar .container');
            
            if (!container || !usesTopBar) return;
            
            const useItems = document.querySelectorAll('.use-item');
            const containerRect = container.getBoundingClientRect();
            
            useItems.forEach((item, index) => {
                const megaMenu = item.querySelector('.mega-menu');
                
                if (megaMenu) {
                    // Set mega menu width and position
                    megaMenu.style.width = containerRect.width + 'px';
                    megaMenu.style.left = '0px';
                    
                    // Mouse events for mega menu
                    item.addEventListener('mouseenter', () => {
                        // Hide all other mega menus
                        document.querySelectorAll('.mega-menu').forEach(menu => {
                            if (menu !== megaMenu) {
                                menu.style.display = 'none';
                            }
                        });
                        // Show current mega menu
                        megaMenu.style.display = 'block';
                    });
                    
                    item.addEventListener('mouseleave', (e) => {
                        const relatedTarget = e.relatedTarget;
                        if (!megaMenu.contains(relatedTarget)) {
                            setTimeout(() => {
                                if (!item.matches(':hover') && !megaMenu.matches(':hover')) {
                                    megaMenu.style.display = 'none';
                                }
                            }, 100);
                        }
                    });
                    
                    // Also handle mega menu mouse events
                    megaMenu.addEventListener('mouseenter', () => {
                        megaMenu.style.display = 'block';
                    });
                    
                    megaMenu.addEventListener('mouseleave', () => {
                        setTimeout(() => {
                            if (!item.matches(':hover') && !megaMenu.matches(':hover')) {
                                megaMenu.style.display = 'none';
                            }
                        }, 100);
                    });
                }
            });
            
            // Close all mega menus when clicking outside
            document.addEventListener('click', (event) => {
                if (!usesTopBar.contains(event.target)) {
                    document.querySelectorAll('.mega-menu').forEach(menu => {
                        menu.style.display = 'none';
                    });
                }
            });
        }

        function loadRelatedProducts() {
            const product = appState.currentProduct;
            if (!product) return;
            
            // Find related products based on multiple criteria (STONE NAME/TYPE BASED)
            appState.relatedProducts = appState.allProducts.filter(p => {
                if (p.id === product.id) return false; // Exclude current product
                
                // Priority 1: Same stone name (different variations)
                if (p.stone_name && product.stone_name) {
                    const currentWords = product.stone_name.toLowerCase().split(' ');
                    const productWords = p.stone_name.toLowerCase().split(' ');
                    
                    // Check for common words in stone names
                    for (const word of currentWords) {
                        if (word.length > 3 && p.stone_name.toLowerCase().includes(word)) {
                            return true;
                        }
                    }
                }
                
                // Priority 2: Same category
                if (p.category && product.category && p.category === product.category) {
                    return true;
                }
                
                // Priority 3: Same type
                if (p.type && product.type && p.type === product.type) {
                    return true;
                }
                
                // Priority 4: Same uses
                if (p.uses && product.uses && p.uses === product.uses) {
                    return true;
                }
                
                return false;
            });
            
            // Sort by relevance (stone name matches first, then category, then type)
            appState.relatedProducts.sort((a, b) => {
                const aScore = calculateRelevanceScore(a, product);
                const bScore = calculateRelevanceScore(b, product);
                return bScore - aScore;
            });
            
            // Limit to 8 products
            appState.relatedProducts = appState.relatedProducts.slice(0, 8);
            
            // If not enough related products, get random other products
            if (appState.relatedProducts.length < 4) {
                const otherProducts = appState.allProducts.filter(p => 
                    p.id !== product.id && 
                    !appState.relatedProducts.some(rp => rp.id === p.id)
                ).sort(() => Math.random() - 0.5)
                 .slice(0, 8 - appState.relatedProducts.length);
                
                appState.relatedProducts = [...appState.relatedProducts, ...otherProducts];
            }
            
            displayRelatedProducts();
        }

        function calculateRelevanceScore(product, currentProduct) {
            let score = 0;
            
            // Stone name match (highest priority)
            if (product.stone_name && currentProduct.stone_name) {
                const currentWords = currentProduct.stone_name.toLowerCase().split(' ');
                const productWords = product.stone_name.toLowerCase().split(' ');
                
                for (const word of currentWords) {
                    if (word.length > 3 && product.stone_name.toLowerCase().includes(word)) {
                        score += 10;
                    }
                }
            }
            
            // Category match
            if (product.category && currentProduct.category && 
                product.category === currentProduct.category) {
                score += 5;
            }
            
            // Type match
            if (product.type && currentProduct.type && 
                product.type === currentProduct.type) {
                score += 3;
            }
            
            // Uses match
            if (product.uses && currentProduct.uses && 
                product.uses === currentProduct.uses) {
                score += 2;
            }
            
            return score;
        }

        function displayRelatedProducts() {
            const container = document.getElementById('relatedProductsGrid');
            if (!container) return;
            
            if (appState.relatedProducts.length === 0) {
                container.innerHTML = `
                    <div class="no-products" style="grid-column: 1 / -1;">
                        <i class="fas fa-info-circle"></i>
                        <p>No related products found</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            appState.relatedProducts.forEach(product => {
                const images = product.images || [];
                const imageUrl = images[0] || product.image || getDefaultImage(product.category);
                const description = product.description || "No description";
                const rate = product.rate || product.price || "N/A";
                const detailsLink = product.pageUrl || `product-details.html?id=${product.id}`;

                const cardHTML = `
                    <div class="product-card">
                        <a href="${detailsLink}">
                            <div class="product-img-box">
                                <img src="${imageUrl}" alt="Product Image" class="product-img">
                            </div>
                        </a>
                        <p class="product-description">${description.length > 100 ? description.substring(0, 100) + '...' : description}</p>
                        <p class="product-rate">¬£ ${rate}</p>
                        <a href="${detailsLink}" class="details-btn">View Details</a>
                    </div>
                `;

                container.innerHTML += cardHTML;
            });
        }

        function showInquiryForm() {
            const product = appState.currentProduct;
            if (!product) return;
            
            // Create a simple inquiry modal
            const inquiryHTML = `
                <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 2000; display: flex; align-items: center; justify-content: center;">
                    <div style="background: white; padding: 30px; border-radius: 10px; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 style="margin: 0; color: #333;">Inquire About ${product.stone_name}</h3>
                            <button id="closeInquiry" style="background: none; border: none; font-size: 20px; cursor: pointer; color: #666;">&times;</button>
                        </div>
                        
                        <form id="inquiryForm">
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; color: #333; font-weight: 500;">Your Name</label>
                                <input type="text" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; color: #333; font-weight: 500;">Your Email</label>
                                <input type="email" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; color: #333; font-weight: 500;">Your Phone</label>
                                <input type="tel" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; color: #333; font-weight: 500;">Quantity Required</label>
                                <input type="text" placeholder="e.g., 100 sq ft" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 5px; color: #333; font-weight: 500;">Message</label>
                                <textarea rows="4" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;" placeholder="Any specific requirements or questions..."></textarea>
                            </div>
                            
                            <button type="submit" style="background: #b8860b; color: white; border: none; padding: 12px 25px; border-radius: 5px; font-weight: 600; cursor: pointer; width: 100%;">Submit Inquiry</button>
                        </form>
                    </div>
                </div>
            `;
            
            // Add modal to page
            const modalDiv = document.createElement('div');
            modalDiv.innerHTML = inquiryHTML;
            document.body.appendChild(modalDiv);
            
            // Add event listeners
            document.getElementById('closeInquiry').addEventListener('click', function() {
                document.body.removeChild(modalDiv);
            });
            
            document.getElementById('inquiryForm').addEventListener('submit', function(e) {
                e.preventDefault();
                alert('Thank you for your inquiry! We will contact you soon.');
                document.body.removeChild(modalDiv);
            });
            
            // Close modal when clicking outside
            modalDiv.addEventListener('click', function(e) {
                if (e.target === modalDiv) {
                    document.body.removeChild(modalDiv);
                }
            });
        }

        // Helper Functions
        function getDefaultImage(category) {
            const defaultImages = {
                'marble': 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=400&q=80',
                'granite': 'https://images.unsplash.com/photo-1595428774223-ef52624120d2?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=400&q=80',
                'limestone': 'https://images.unsplash.com/photo-1611273426858-450d8e3c9fce?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=400&q=80',
                'sandstone': 'https://images.unsplash.com/photo-1541140532154-b024d705b90a?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=400&q=80',
                'red sand stone': 'https://i.ibb.co/HLpBc94R/51b7aaab131a.jpg'
            };
            
            const cat = category ? category.toLowerCase() : 'marble';
            return defaultImages[cat] || defaultImages.marble;
        }

        function showError(message) {
            document.getElementById('productDetailsContainer').innerHTML = `
                <div style="text-align: center; padding: 50px 20px;">
                    <i class="fas fa-exclamation-triangle" style="font-size: 48px; color: #ff9900; margin-bottom: 20px;"></i>
                    <h3 style="color: #333; margin-bottom: 15px;">${message}</h3>
                    <a href="category-products.html" class="details-btn" style="display: inline-block; width: auto;">Browse Products</a>
                </div>
            `;
        }

        // ‚úÖ AUTHENTICATION FUNCTIONS
        function initializeAuth() {
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    appState.user = {
                        uid: user.uid,
                        email: user.email,
                        name: user.displayName || user.email.split('@')[0]
                    };
                    updateUserInterface();
                } else {
                    appState.user = null;
                    updateUserInterface();
                }
            });
        }

        function updateUserInterface() {
            if (appState.user) {
                // User is logged in
                document.getElementById('userProfile').style.display = 'block';
                document.getElementById('loginButton').style.display = 'none';
                document.getElementById('addProductButton').style.display = 'flex';
                
                // Update user info
                document.getElementById('profileName').textContent = appState.user.name;
                document.getElementById('profileAvatar').textContent = appState.user.name.charAt(0).toUpperCase();
                document.getElementById('dropdownUserName').textContent = appState.user.name;
                document.getElementById('dropdownUserEmail').textContent = appState.user.email;
            } else {
                // User is not logged in
                document.getElementById('userProfile').style.display = 'none';
                document.getElementById('loginButton').style.display = 'flex';
                document.getElementById('addProductButton').style.display = 'none';
            }
        }

        // ‚úÖ SAMPLE DATA FALLBACK
        function getSampleProducts() {
            return [
                {
                    id: "1",
                    stone_name: "RED SAND STONE",
                    category: "Red Sand Stone",
                    type: "Natural",
                    color: "Red",
                    size: "10",
                    length: "5",
                    width: "2",
                    thickness: "20-30 mm",
                    uses: "Flooring",
                    price: 100,
                    price_unit: "sqft",
                    description: "Premium red sandstone with excellent durability and natural beauty. Perfect for flooring applications in both residential and commercial projects. The natural red hue adds warmth and character to any space.",
                    density: "2.4 g/cm¬≥",
                    finish: "Natural",
                    water_absorption: "Low",
                    rate_description: "Competitive pricing with bulk discounts available",
                    factory_name: "ravi jain",
                    contact_number: "+91 7737740207",
                    email: "ravijain236129@gmail.com",
                    compressive_strength: "High",
                    images: [
                        "https://i.ibb.co/HLpBc94R/51b7aaab131a.jpg",
                        "https://images.unsplash.com/photo-1541140532154-b024d705b90a?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
                        "https://images.unsplash.com/photo-1601553598910-aab9e5a5e658?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80"
                    ],
                    pageUrl: "product-details.html?id=1"
                },
                {
                    id: "2",
                    stone_name: "WHITE MARBLE",
                    category: "Marble",
                    type: "Natural",
                    color: "White",
                    size: "12",
                    length: "6",
                    width: "3",
                    thickness: "25-35 mm",
                    uses: "Flooring",
                    price: 150,
                    price_unit: "sqft",
                    description: "Elegant white marble with fine veining for luxurious interiors. This premium marble is ideal for flooring, wall cladding, and countertops in high-end residential and commercial spaces.",
                    density: "2.7 g/cm¬≥",
                    finish: "Polished",
                    water_absorption: "Medium",
                    rate_description: "Premium quality marble at competitive prices",
                    factory_name: "marble works",
                    contact_number: "+91 9876543210",
                    email: "info@marbleworks.com",
                    compressive_strength: "Medium",
                    images: [
                        "https://images.unsplash.com/photo-1586023492125-27b2c045efd7?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
                        "https://images.unsplash.com/photo-1568515042948-bf1c8e79f4cb?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80"
                    ],
                    pageUrl: "product-details.html?id=2"
                },
                {
                    id: "3",
                    stone_name: "BLACK GRANITE",
                    category: "Granite",
                    type: "Natural",
                    color: "Black",
                    size: "15",
                    length: "7",
                    width: "4",
                    thickness: "30-40 mm",
                    uses: "Countertop",
                    price: 200,
                    price_unit: "sqft",
                    description: "Durable black granite perfect for kitchen countertops. This high-density granite offers excellent resistance to scratches, heat, and stains, making it ideal for heavy-use areas.",
                    density: "2.8 g/cm¬≥",
                    finish: "Polished",
                    water_absorption: "Very Low",
                    rate_description: "High-end granite with excellent durability",
                    factory_name: "granite experts",
                    contact_number: "+91 8765432109",
                    email: "sales@graniteexperts.com",
                    compressive_strength: "Very High",
                    images: [
                        "https://images.unsplash.com/photo-1595428774223-ef52624120d2?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
                        "https://images.unsplash.com/photo-1552324190-f087066e1e48?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80"
                    ],
                    pageUrl: "product-details.html?id=3"
                },
                {
                    id: "4",
                    stone_name: "BEIGE LIMESTONE",
                    category: "Limestone",
                    type: "Natural",
                    color: "Beige",
                    size: "11",
                    length: "5.5",
                    width: "2.5",
                    thickness: "22-32 mm",
                    uses: "Wall Cladding",
                    price: 80,
                    price_unit: "sqft",
                    description: "Warm beige limestone ideal for exterior and interior walls. This natural stone offers excellent weather resistance and a timeless aesthetic that complements both traditional and contemporary designs.",
                    density: "2.5 g/cm¬≥",
                    finish: "Honed",
                    water_absorption: "Medium",
                    rate_description: "Affordable limestone with natural appeal",
                    factory_name: "limestone quarry",
                    contact_number: "+91 7654321098",
                    email: "contact@limestonequarry.com",
                    compressive_strength: "Medium",
                    images: [
                        "https://images.unsplash.com/photo-1611273426858-450d8e3c9fce?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
                        "https://images.unsplash.com/photo-1596162955779-9c3295a74120?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80"
                    ],
                    pageUrl: "product-details.html?id=4"
                }
            ];
        }

        console.log('‚úÖ Product Details page initialized successfully!');
    </script>
</body>
</html>
